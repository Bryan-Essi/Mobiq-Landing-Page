"use strict";(self.webpackChunktelco_frontend=self.webpackChunktelco_frontend||[]).push([[408],{925:(e,i,n)=>{n.d(i,{Vj:()=>r,hR:()=>c,ld:()=>l,nn:()=>u,uL:()=>s,ww:()=>d,x7:()=>a});var t=n(2555);const l="deviceManagerMetadata",s="deviceMetadataUpdated",o=[{id:"drivers",label:"Drivers installed",done:!1},{id:"usb_debugging",label:"USB debugging enabled",done:!1},{id:"sim_ready",label:"SIM ready",done:!1}],a=e=>{return{alias:"string"===typeof(null===e||void 0===e?void 0:e.alias)?e.alias:"",tags:(n=null===e||void 0===e?void 0:e.tags,Array.isArray(n)?n.filter(e=>"string"===typeof e).map(e=>e.trim()).filter(e=>e.length>0):[]),notes:"string"===typeof(null===e||void 0===e?void 0:e.notes)?e.notes:"",pinned:Boolean(null===e||void 0===e?void 0:e.pinned),checklist:(i=null===e||void 0===e?void 0:e.checklist,Array.isArray(i)?o.map(e=>{const n=i.find(i=>i&&"object"===typeof i&&i.id===e.id);return n?{id:n.id,label:"string"===typeof n.label?n.label:e.label,done:Boolean(n.done)}:(0,t.A)({},e)}):o.map(e=>(0,t.A)({},e)))};var i,n},r=a(),d=()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return{};try{const e=window.localStorage.getItem(l);if(!e)return{};const i=JSON.parse(e);if(!i||"object"!==typeof i)return{};const n={};return Object.entries(i).forEach(e=>{let[i,t]=e;n[i]=a(t)}),n}catch(e){return console.warn("[deviceMetadata] Failed to read metadata",e),{}}},c=e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{window.localStorage.setItem(l,JSON.stringify(e)),window.dispatchEvent(new Event(s))}catch(i){console.warn("[deviceMetadata] Failed to persist metadata",i)}},u=()=>{const e=d(),i={};return Object.entries(e).forEach(e=>{var n;let[t,l]=e;const s=null===(n=l.alias)||void 0===n?void 0:n.trim();s&&(i[t]=s)}),i}},1408:(e,i,n)=>{n.r(i),n.d(i,{default:()=>te});var t=n(2555),l=n(5043),s=n(9216),o=n(3845),a=n(8903),r=n(2110),d=n(6494),c=n(6446),u=n(3217),h=n(9508),x=n(7392),v=n(5865),g=n(5146),p=n(1787),A=n(1806),m=n(4882),f=n(8076),j=n(39),b=n(3460),w=n(2518),y=n(3193),C=n(9285),S=n(2143),k=n(5078),E=n(8983),F=n(9948),z=n(35),_=n(6600),I=n(5316),B=n(9347),D=n(9917),L=n(3645),T=n(3528),W=n(1680),M=n(687),N=n(7856),U=n(7263),O=n(4830),R=n(7655),P=n(516),V=n(4805),H=n(9292),J=n(6963),G=n(4991),K=n(9350),Q=n(6655),Y=n(8729),q=n(5059),Z=n(9074),X=n(9849),$=n(925),ee=n(579);const ie=e=>e?e.toLowerCase():"unknown",ne=e=>{if(!e)return"Unknown";const i=new Date(e);return Number.isNaN(i.getTime())?"Unknown":i.toLocaleString()},te=e=>{var i;let{backendUrl:n}=e;const{devices:te,status:le,refresh:se,applyDevicePatch:oe}=(0,Y.t)({backendUrl:n,pollMs:5e3}),[ae,re]=(0,l.useState)(""),[de,ce]=(0,l.useState)(()=>(0,$.ww)()),[ue,he]=(0,l.useState)({}),[xe,ve]=(0,l.useState)(0),[ge,pe]=(0,l.useState)(0),[Ae,me]=(0,l.useState)(null),[fe,je]=(0,l.useState)([]),[be,we]=(0,l.useState)("cards"),[ye,Ce]=(0,l.useState)(new Set),[Se,ke]=(0,l.useState)("all"),[Ee,Fe]=(0,l.useState)("all"),[ze,_e]=(0,l.useState)("all"),[Ie,Be]=(0,l.useState)("any"),[De,Le]=(0,l.useState)({}),[Te,We]=(0,l.useState)(""),[Me,Ne]=(0,l.useState)(""),[Ue,Oe]=(0,l.useState)(""),[Re,Pe]=(0,l.useState)("all"),[Ve,He]=(0,l.useState)(0),Je=10,Ge=e=>{switch(ie(e)){case"connected":return{bg:"#EEF2FF",color:"#2563EB"};case"online":return{bg:"#ECFDF5",color:"#16A34A"};case"offline":return{bg:"#FEF2F2",color:"#DC2626"};case"busy":return{bg:"#FEF3C7",color:"#B45309"};default:return{bg:"#F1F5F9",color:"#64748B"}}},Ke=async(e,i)=>{try{const l={disconnect:{status:"disconnecting"},reboot:{status:"restarting"},test:{status:"testing"},logs:{status:"collecting_logs"}}[i];l&&oe(e,(0,t.A)((0,t.A)({},l),{},{last_seen:(new Date).toISOString()}));(await fetch("".concat(n,"/api/v1/devices/").concat(e,"/").concat(i),{method:"POST"})).ok&&se()}catch(l){console.error("Error ".concat(i," device:"),l)}};(0,l.useEffect)(()=>{(0,$.hR)(de)},[de]),(0,l.useEffect)(()=>{const e=()=>ve(e=>e+1),i=i=>{i.key===q.Ll&&e()};return window.addEventListener(q.ag,e),window.addEventListener("storage",i),()=>{window.removeEventListener(q.ag,e),window.removeEventListener("storage",i)}},[]),(0,l.useEffect)(()=>{const e=()=>pe(e=>e+1),i=i=>{i.key===X.lp&&e()};return window.addEventListener(X.i7,e),window.addEventListener("storage",i),()=>{window.removeEventListener(X.i7,e),window.removeEventListener("storage",i)}},[]),(0,l.useEffect)(()=>{(0,q.xp)(te)},[te]);const Qe=(e,i)=>{ce(n=>{var l;const s=(0,$.x7)(null!==(l=n[e])&&void 0!==l?l:$.Vj),o="function"===typeof i?i(s):i,a=(0,$.x7)((0,t.A)((0,t.A)({},s),o));return(0,t.A)((0,t.A)({},n),{},{[e]:a})})},Ye=e=>{var i;const n=(null!==(i=ue[e])&&void 0!==i?i:"").trim();n&&(Qe(e,e=>({tags:e.tags.includes(n)?e.tags:[...e.tags,n]})),he(i=>(0,t.A)((0,t.A)({},i),{},{[e]:""})))},qe=e=>{var i,n;const t=(null===(i=de[e.id])||void 0===i||null===(n=i.alias)||void 0===n?void 0:n.trim())||e.model||e.id;me({deviceId:e.id,name:t}),je((0,X.uK)(e.id))},Ze=()=>{me(null),je([])},Xe=(e,i)=>{Ce(n=>{const t=new Set(n);return i?t.add(e):t.delete(e),t})},$e=()=>Ce(new Set),ei=async e=>{const i=Array.from(ye);0!==i.length&&("pin"!==e&&"unpin"!==e?(await Promise.all(i.map(i=>Ke(i,e).catch(()=>null))),$e()):i.forEach(i=>Qe(i,{pinned:"pin"===e})))},ii=(0,l.useMemo)(()=>(0,q.Qt)(),[xe]),ni=(0,l.useMemo)(()=>(0,X.TZ)(),[ge]),ti=(0,l.useMemo)(()=>{const e=new Map;return te.forEach(i=>{var n;e.set(i.id,(0,t.A)((0,t.A)({},i),{},{__historical:!1,__registry:null!==(n=ii[i.id])&&void 0!==n?n:null}))}),Object.values(ii).forEach(i=>{var n;e.has(i.id)||e.set(i.id,{id:i.id,model:null!==(n=i.model)&&void 0!==n?n:"Unknown Device",connection_type:i.connectionType,status:"offline",last_seen:i.lastSeen,__historical:!0,__registry:i})}),Array.from(e.values()).sort((e,i)=>{var n,t;const l=e.__historical?1:0,s=i.__historical?1:0;if(l!==s)return l-s;const o=e.last_seen||(null===(n=e.__registry)||void 0===n?void 0:n.lastSeen)||"";return(i.last_seen||(null===(t=i.__registry)||void 0===t?void 0:t.lastSeen)||""||"").localeCompare(o||"")})},[te,ii]),li=(0,l.useMemo)(()=>{const e=new Set;return Object.values(de).forEach(i=>{var n;return null===i||void 0===i||null===(n=i.tags)||void 0===n?void 0:n.forEach(i=>e.add(i))}),Array.from(e).sort((e,i)=>e.localeCompare(i))},[de]),si=(0,l.useMemo)(()=>{const e=ae.trim().toLowerCase();return ti.filter(i=>{var n,t;const l=de[i.id],s=i.__registry,o=[i.model,i.id,i.os_version,null===l||void 0===l?void 0:l.alias,...null!==(n=null===l||void 0===l?void 0:l.tags)&&void 0!==n?n:[],null===s||void 0===s?void 0:s.model].filter(Boolean).join(" ").toLowerCase();return!(e&&!o.includes(e))&&(("all"===Se||ie(i.status)===Se||"offline"===Se&&"unknown"===ie(i.status))&&(!!("all"===Ee||null!==l&&void 0!==l&&null!==(t=l.tags)&&void 0!==t&&t.includes(Ee))&&(!("historical"===ze&&!i.__historical)&&(("live"!==ze||!i.__historical)&&!!((e,i)=>{if("any"===i)return!0;if(!e)return!1;const n=new Date(e);if(Number.isNaN(n.getTime()))return!1;const t=Date.now()-n.getTime(),l=864e5;return"24h"===i?t<=l:"7d"===i?t<=7*l:t<=30*l})(i.last_seen||(null===s||void 0===s?void 0:s.lastSeen),Ie)))))})},[ti,de,ae,Se,Ee,ze,Ie]),oi=((0,l.useMemo)(()=>ti.filter(e=>{var i;return null===(i=de[e.id])||void 0===i?void 0:i.pinned}),[ti,de]),(0,l.useMemo)(()=>{const e={};return Object.values(de).forEach(i=>{var n;null===i||void 0===i||null===(n=i.tags)||void 0===n||n.forEach(i=>{e[i]=(e[i]||0)+1})}),Object.entries(e).sort((e,i)=>i[1]-e[1]).slice(0,5)},[de]),(0,l.useMemo)(()=>{const e=[];return Object.entries(ni).forEach(i=>{let[n,l]=i;l.slice(0,3).forEach(i=>e.push((0,t.A)((0,t.A)({},i),{},{deviceId:n})))}),e.sort((e,i)=>(i.timestamp||"").localeCompare(e.timestamp||"")).slice(0,5)},[ni]),(0,l.useMemo)(()=>{let e=fe;if(Ue.trim()){const i=Ue.toLowerCase();e=e.filter(e=>[e.label,e.referenceId,e.details].filter(Boolean).join(" ").toLowerCase().includes(i))}if("all"!==Re){var i;((null===(i=de[(null===Ae||void 0===Ae?void 0:Ae.deviceId)||""])||void 0===i?void 0:i.tags)||[]).includes(Re)||(e=[])}return e},[null===Ae||void 0===Ae?void 0:Ae.deviceId,fe,Ue,Re,de])),ai=(0,l.useMemo)(()=>{const e=Ve*Je;return oi.slice(e,e+Je)},[oi,Ve,Je]),ri=((0,l.useMemo)(()=>{var e,i,n;let t=0,l=0;const s={};Object.entries(ni).forEach(e=>{let[i,n]=e;n.forEach(e=>{"workflow"===e.type?t+=1:l+=1}),s[i]=n.length});const o=null===(e=Object.entries(s).sort((e,i)=>i[1]-e[1])[0])||void 0===e?void 0:e[0],a=o&&((null===(i=de[o])||void 0===i?void 0:i.alias)||(null===(n=ti.find(e=>e.id===o))||void 0===n?void 0:n.model)||o);return{workflowCount:t,moduleCount:l,mostActiveDevice:a}},[ni,de,ti]),ye.size),di=si.length>0&&si.every(e=>ye.has(e.id)),ci=(e,i)=>i&&0!==i.length?(0,ee.jsx)(s.A,{direction:"row",spacing:1,flexWrap:"wrap",sx:{mb:2},children:i.map(i=>(0,ee.jsx)(o.A,{label:i.label,icon:i.done?(0,ee.jsx)(D.A,{size:12}):(0,ee.jsx)(G.A,{size:12}),onClick:()=>((e,i)=>{Qe(e,e=>{var n;return{checklist:(null!==(n=e.checklist)&&void 0!==n?n:[]).map(e=>e.id===i?(0,t.A)((0,t.A)({},e),{},{done:!e.done}):e)}})})(e,i.id),sx:{backgroundColor:i.done?"#DCFCE7":"#F1F5F9",color:i.done?"#15803D":"#475569","& .MuiChip-icon":{color:i.done?"#15803D":"#94A3B8"}}},"".concat(e,"-").concat(i.id)))}):null,ui=e=>{var i,n,l,A,m,f,j,b,w,y;const C=e.__registry,S=!0===e.__historical,k=null!==(i=de[e.id])&&void 0!==i?i:$.Vj,E=(null===(n=k.alias)||void 0===n?void 0:n.trim())||e.model||(null===C||void 0===C?void 0:C.model)||"Unknown Device",F=null!==(l=k.tags)&&void 0!==l?l:[],z=null!==(A=ue[e.id])&&void 0!==A?A:"",_=Boolean(k.pinned),I=e.last_seen||(null===C||void 0===C?void 0:C.lastSeen)||(null===C||void 0===C?void 0:C.firstSeen)||null,B=e.connection_type||(null===C||void 0===C?void 0:C.connectionType)||"Unknown",D=S?{bg:"#F3F4F6",color:"#6B7280"}:Ge(e.status),M=(null!==(m=ni[e.id])&&void 0!==m?m:[]).slice(0,3),P=M.filter(e=>"module"===e.type).length,H=M.filter(e=>"workflow"===e.type).length,G=(null!==(f=ni[e.id])&&void 0!==f?f:[]).length>0,Q=null!==(j=null!==(b=De[e.id])&&void 0!==b?b:k.notes)&&void 0!==j?j:"";return(0,ee.jsx)(a.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsx)(r.A,{sx:{backgroundColor:"#F8FAFC",border:ye.has(e.id)?"2px solid #2563EB":"1px solid #E5E7EB",borderRadius:"12px",transition:"all 0.2s","&:hover":{boxShadow:"0 4px 8px rgba(16, 24, 40, 0.12)",borderColor:"#2563EB"}},children:(0,ee.jsxs)(d.A,{sx:{padding:"20px"},children:[(0,ee.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[(0,ee.jsxs)(c.A,{display:"flex",alignItems:"center",gap:1,children:[(0,ee.jsx)(u.A,{checked:ye.has(e.id),onChange:i=>Xe(e.id,i.target.checked)}),(0,ee.jsx)(o.A,{label:S?"History":e.status||"Unknown",size:"small",sx:{backgroundColor:D.bg,color:D.color,fontWeight:600,textTransform:"capitalize"}})]}),(0,ee.jsxs)(s.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,ee.jsx)(h.A,{title:_?"Unpin device":"Pin device",children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>{return i=e.id,void Qe(i,e=>({pinned:!e.pinned}));var i},sx:{backgroundColor:_?"#FFE4E6":"#F1F5F9",color:_?"#BE123C":"#475569",width:32,height:32},children:_?(0,ee.jsx)(L.A,{size:16}):(0,ee.jsx)(T.A,{size:16})})}),(0,ee.jsx)(h.A,{title:G?"View timeline":"No activity yet",children:(0,ee.jsx)("span",{children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>qe(e),disabled:!G,sx:{width:32,height:32},children:(0,ee.jsx)(U.A,{size:16})})})})]})]}),(0,ee.jsxs)(c.A,{display:"flex",alignItems:"center",gap:2,mb:2,children:[(0,ee.jsx)(c.A,{sx:{backgroundColor:D.bg,borderRadius:"12px",p:1.5,color:D.color},children:(0,ee.jsx)(J.A,{size:24})}),(0,ee.jsxs)(c.A,{children:[(0,ee.jsx)(v.A,{variant:"h6",sx:{fontSize:"16px",fontWeight:700,color:"#0F172A"},children:E}),(0,ee.jsxs)(v.A,{variant:"body2",sx:{color:"#6B7280",fontSize:"12px"},children:[e.model&&e.model!==E?"".concat(e.model," \u2022 "):"",e.id]})]})]}),(0,ee.jsxs)(c.A,{display:"flex",alignItems:"center",gap:1.5,sx:{mb:2},children:[(0,ee.jsx)(N.A,{size:16,color:"#6B7280"}),(0,ee.jsxs)(v.A,{variant:"caption",sx:{color:"#6B7280",fontSize:"12px"},children:["Android ",e.os_version||"Unknown"]})]}),(0,ee.jsx)(g.A,{size:"small",label:"Alias",fullWidth:!0,value:null!==(w=k.alias)&&void 0!==w?w:"",onChange:i=>{return n=e.id,t=i.target.value,void Qe(n,{alias:t});var n,t},sx:{mb:1.5}}),(0,ee.jsx)(s.A,{direction:"row",spacing:1,flexWrap:"wrap",sx:{mb:1},children:0===F.length?(0,ee.jsx)(v.A,{variant:"caption",sx:{color:"#94A3B8"},children:"No tags yet"}):F.map(i=>(0,ee.jsx)(o.A,{label:"#".concat(i),size:"small",onDelete:()=>((e,i)=>{Qe(e,e=>({tags:e.tags.filter(e=>e!==i)}))})(e.id,i),sx:{backgroundColor:"#E0E7FF",color:"#1E3A8A"}},"".concat(e.id,"-").concat(i)))}),(0,ee.jsx)(g.A,{size:"small",placeholder:"Add tag (enter)",value:z,onChange:i=>{return n=e.id,l=i.target.value,void he(e=>(0,t.A)((0,t.A)({},e),{},{[n]:l}));var n,l},onKeyDown:i=>{"Enter"===i.key&&(i.preventDefault(),Ye(e.id))},InputProps:{endAdornment:(0,ee.jsx)(p.A,{position:"end",children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>Ye(e.id),children:(0,ee.jsx)(K.A,{size:14})})})},sx:{mb:2}}),ci(e.id,k.checklist),(0,ee.jsx)(g.A,{label:"Notes",size:"small",fullWidth:!0,multiline:!0,minRows:2,value:Q,onChange:i=>{return n=e.id,l=i.target.value,void Le(e=>(0,t.A)((0,t.A)({},e),{},{[n]:l}));var n,l},onBlur:()=>(e=>{const i=De[e];Qe(e,{notes:null!==i&&void 0!==i?i:""}),Le(i=>{const n=(0,t.A)({},i);return delete n[e],n})})(e.id),sx:{mb:2}}),(0,ee.jsxs)(v.A,{variant:"caption",sx:{color:"#6B7280",fontSize:"12px"},children:["Last seen: ",ne(I)," \u2022 Connection: ",B]}),(0,ee.jsxs)(v.A,{variant:"caption",sx:{color:"#475569",fontSize:"12px",display:"block",mb:2},children:[H," workflow",1===H?"":"s"," \u2022 ",P," module",1===P?"":"s",null!==(y=M[0])&&void 0!==y&&y.timestamp?" \u2022 Last activity: ".concat(ne(M[0].timestamp)):""]}),(0,ee.jsxs)(s.A,{direction:"row",spacing:1,justifyContent:"space-between",alignItems:"center",children:[(0,ee.jsxs)(s.A,{direction:"row",spacing:1,children:[(0,ee.jsx)(h.A,{title:S?"Unavailable for historical devices":"Disconnect from ADB",children:(0,ee.jsx)("span",{children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>Ke(e.id,"disconnect"),disabled:S,sx:{backgroundColor:"#FFF7ED",color:"#C2410C",width:32,height:32,opacity:S?.5:1},children:(0,ee.jsx)(R.A,{size:16})})})}),(0,ee.jsx)(h.A,{title:S?"Unavailable for historical devices":"Reboot device",children:(0,ee.jsx)("span",{children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>Ke(e.id,"reboot"),disabled:S,sx:{backgroundColor:"#E0F2FE",color:"#0369A1",width:32,height:32,opacity:S?.5:1},children:(0,ee.jsx)(V.A,{size:16})})})}),(0,ee.jsx)(h.A,{title:S?"Unavailable for historical devices":"Capture logs",children:(0,ee.jsx)("span",{children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>Ke(e.id,"logs"),disabled:S,sx:{backgroundColor:"#EEF2FF",color:"#4338CA",width:32,height:32,opacity:S?.5:1},children:(0,ee.jsx)(W.A,{size:16})})})})]}),(0,ee.jsxs)(s.A,{direction:"row",spacing:1,children:[(0,ee.jsx)(h.A,{title:"Device Info",children:(0,ee.jsx)(x.A,{size:"small",sx:{backgroundColor:"#F1F5F9",color:"#475569",width:32,height:32},children:(0,ee.jsx)(N.A,{size:16})})}),(0,ee.jsx)(h.A,{title:S?"Unavailable for historical devices":"Run quick test",children:(0,ee.jsx)("span",{children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>Ke(e.id,"test"),disabled:S,sx:{backgroundColor:"#2563EB",color:"white",width:32,height:32,opacity:S?.5:1},children:(0,ee.jsx)(O.A,{size:16})})})})]})]})]})})},e.id)};return(0,ee.jsxs)(Q.A,{children:[(0,ee.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[(0,ee.jsx)(v.A,{variant:"h1",sx:{fontSize:"28px",lineHeight:"36px",fontWeight:700,color:"#0F172A"},children:"Device Manager"}),(0,ee.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,ee.jsx)(g.A,{placeholder:"Search devices...",value:ae,onChange:e=>re(e.target.value),sx:{width:280,"& .MuiOutlinedInput-root":{height:40,borderRadius:"10px"}},InputProps:{startAdornment:(0,ee.jsx)(p.A,{position:"start",children:(0,ee.jsx)(H.A,{size:20,color:"#6B7280"})})}}),(0,ee.jsx)(w.A,{variant:"contained",startIcon:(0,ee.jsx)(P.A,{size:20}),onClick:se,sx:{height:40,borderRadius:"10px",backgroundColor:"#2563EB",textTransform:"none",fontWeight:600},children:"Scan Devices"})]})]}),(0,ee.jsxs)(c.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,mb:3},children:[(0,ee.jsx)(y.A,{size:"small",sx:{minWidth:150},children:(0,ee.jsx)(C.A,{value:Se,onChange:e=>ke(e.target.value),children:[{value:"all",label:"All statuses"},{value:"connected",label:"Connected"},{value:"online",label:"Online"},{value:"busy",label:"Busy"},{value:"offline",label:"Offline"}].map(e=>(0,ee.jsx)(S.A,{value:e.value,children:e.label},e.value))})}),(0,ee.jsx)(y.A,{size:"small",sx:{minWidth:150},children:(0,ee.jsxs)(C.A,{value:Ee,onChange:e=>Fe(e.target.value),children:[(0,ee.jsx)(S.A,{value:"all",children:"All tags"}),li.map(e=>(0,ee.jsxs)(S.A,{value:e,children:["#",e]},e))]})}),(0,ee.jsx)(y.A,{size:"small",sx:{minWidth:150},children:(0,ee.jsx)(C.A,{value:ze,onChange:e=>_e(e.target.value),children:[{value:"all",label:"All devices"},{value:"live",label:"Live only"},{value:"historical",label:"History only"}].map(e=>(0,ee.jsx)(S.A,{value:e.value,children:e.label},e.value))})}),(0,ee.jsx)(y.A,{size:"small",sx:{minWidth:150},children:(0,ee.jsx)(C.A,{value:Ie,onChange:e=>Be(e.target.value),children:[{value:"any",label:"Any time"},{value:"24h",label:"Last 24h"},{value:"7d",label:"Last 7 days"},{value:"30d",label:"Last 30 days"}].map(e=>(0,ee.jsx)(S.A,{value:e.value,children:e.label},e.value))})}),(0,ee.jsxs)(k.A,{size:"small",exclusive:!0,value:be,onChange:(e,i)=>{i&&we(i)},sx:{ml:"auto"},children:[(0,ee.jsx)(E.A,{value:"cards",children:"Cards"}),(0,ee.jsx)(E.A,{value:"table",children:"Table"})]})]}),ri>0&&(0,ee.jsx)(r.A,{sx:{mb:3,border:"1px solid #2563EB",backgroundColor:"#EEF2FF"},children:(0,ee.jsxs)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center"},children:[(0,ee.jsxs)(v.A,{sx:{fontWeight:600,color:"#1E3A8A"},children:[ri," device",1===ri?"":"s"," selected"]}),(0,ee.jsxs)(F.A,{size:"small",variant:"contained",children:[(0,ee.jsx)(w.A,{onClick:()=>ei("disconnect"),children:"Disconnect"}),(0,ee.jsx)(w.A,{onClick:()=>ei("reboot"),children:"Reboot"}),(0,ee.jsx)(w.A,{onClick:()=>ei("logs"),children:"Logs"}),(0,ee.jsx)(w.A,{onClick:()=>ei("pin"),children:"Pin"}),(0,ee.jsx)(w.A,{onClick:()=>ei("unpin"),children:"Unpin"})]}),(0,ee.jsx)(w.A,{size:"small",onClick:$e,sx:{textTransform:"none"},children:"Clear selection"})]})}),(0,ee.jsx)(r.A,{sx:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"16px",boxShadow:"0 1px 2px rgba(16, 24, 40, 0.06)"},children:(0,ee.jsxs)(d.A,{sx:{padding:"20px 24px"},children:[(0,ee.jsxs)(v.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:"#0F172A",mb:3},children:["Devices (",si.length,si.length!==ti.length?" / ".concat(ti.length):"",")"]}),0===si.length?(0,ee.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8},children:[(0,ee.jsx)(J.A,{size:56,color:"#6B7280",style:{marginBottom:16}}),(0,ee.jsx)(v.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:1},children:0===ti.length?"No devices recorded yet":0===te.length?"No devices connected":"No devices match this filter"}),(0,ee.jsx)(v.A,{sx:{fontSize:"14px",color:"#6B7280",mb:3,maxWidth:320},children:0===ti.length?"Connect a device once to start building its history.":0===te.length?"Connect an Android device via USB and enable USB debugging.":"Try adjusting your search or tags to see other devices."}),(0,ee.jsx)(w.A,{variant:"contained",startIcon:(0,ee.jsx)(P.A,{size:16}),onClick:se,sx:{height:44,borderRadius:"12px",backgroundColor:"#2563EB",textTransform:"none",fontWeight:600},children:"Scan Again"})]}):"table"===be?(0,ee.jsxs)(c.A,{children:[(0,ee.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,ee.jsx)(u.A,{checked:di,indeterminate:ye.size>0&&!di,onChange:e=>{return i=e.target.checked,n=si,void Ce(i?e=>{const i=new Set(e);return n.forEach(e=>i.add(e.id)),i}:e=>{const i=new Set(e);return n.forEach(e=>i.delete(e.id)),i});var i,n}}),(0,ee.jsx)(v.A,{sx:{color:"#475569",fontSize:"14px"},children:"Select all"})]}),(0,ee.jsxs)(A.A,{size:"small",children:[(0,ee.jsx)(m.A,{children:(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(j.A,{padding:"checkbox"}),(0,ee.jsx)(j.A,{children:"Device"}),(0,ee.jsx)(j.A,{children:"Status"}),(0,ee.jsx)(j.A,{children:"Last seen"}),(0,ee.jsx)(j.A,{children:"Tags"}),(0,ee.jsx)(j.A,{align:"right",children:"Workflows"}),(0,ee.jsx)(j.A,{align:"right",children:"Modules"}),(0,ee.jsx)(j.A,{align:"right",children:"Timeline"})]})}),(0,ee.jsx)(b.A,{children:si.map(e=>{var i,n,t,l,s;const a=e,r=a.__registry,d=!0===a.__historical,c=null!==(i=de[e.id])&&void 0!==i?i:$.Vj,g=(null===(n=c.alias)||void 0===n?void 0:n.trim())||e.model||(null===r||void 0===r?void 0:r.model)||e.id,p=d?{bg:"#F3F4F6",color:"#6B7280"}:Ge(e.status),A=null!==(t=ni[e.id])&&void 0!==t?t:[],m=A.filter(e=>"module"===e.type).length,b=A.filter(e=>"workflow"===e.type).length,w=A.length>0;return(0,ee.jsxs)(f.A,{children:[(0,ee.jsx)(j.A,{padding:"checkbox",children:(0,ee.jsx)(u.A,{checked:ye.has(e.id),onChange:i=>Xe(e.id,i.target.checked)})}),(0,ee.jsxs)(j.A,{children:[(0,ee.jsx)(v.A,{sx:{fontWeight:600,color:"#0F172A"},children:g}),(0,ee.jsx)(v.A,{sx:{fontSize:"12px",color:"#6B7280"},children:e.id})]}),(0,ee.jsx)(j.A,{children:(0,ee.jsx)(o.A,{label:d?"History":e.status||"Unknown",size:"small",sx:{backgroundColor:p.bg,color:p.color,fontWeight:600,textTransform:"capitalize"}})}),(0,ee.jsx)(j.A,{children:ne(e.last_seen||(null===r||void 0===r?void 0:r.lastSeen))}),(0,ee.jsx)(j.A,{children:0===(null!==(l=c.tags)&&void 0!==l?l:[]).length?"\u2014":(null!==(s=c.tags)&&void 0!==s?s:[]).map(e=>"#".concat(e)).join(", ")}),(0,ee.jsx)(j.A,{align:"right",children:b}),(0,ee.jsx)(j.A,{align:"right",children:m}),(0,ee.jsx)(j.A,{align:"right",children:(0,ee.jsx)(h.A,{title:w?"View activity history":"No activity yet",children:(0,ee.jsx)("span",{children:(0,ee.jsx)(x.A,{size:"small",onClick:()=>qe(a),disabled:!w,children:(0,ee.jsx)(U.A,{size:16})})})})})]},"".concat(e.id,"-table"))})})]})]}):(0,ee.jsx)(a.Ay,{container:!0,spacing:3,children:si.map(e=>ui(e))})]})}),(0,ee.jsxs)(z.A,{open:Boolean(Ae),onClose:Ze,maxWidth:"sm",fullWidth:!0,children:[(0,ee.jsxs)(_.A,{sx:{fontWeight:600,color:"#0F172A"},children:["Device History \u2014 ",(null===Ae||void 0===Ae?void 0:Ae.name)||""]}),(0,ee.jsxs)(I.A,{dividers:!0,children:[(0,ee.jsxs)(s.A,{direction:"row",spacing:2,mb:2,flexWrap:"wrap",rowGap:2,children:[(0,ee.jsx)(g.A,{label:"Start date/time",type:"datetime-local",size:"small",value:Te,onChange:e=>We(e.target.value),InputLabelProps:{shrink:!0}}),(0,ee.jsx)(g.A,{label:"End date/time",type:"datetime-local",size:"small",value:Me,onChange:e=>Ne(e.target.value),InputLabelProps:{shrink:!0}}),(0,ee.jsx)(g.A,{label:"Search history",size:"small",value:Ue,onChange:e=>{Oe(e.target.value),He(0)}}),(0,ee.jsx)(y.A,{size:"small",sx:{minWidth:140},children:(0,ee.jsxs)(C.A,{value:Re,displayEmpty:!0,onChange:e=>{Pe(e.target.value),He(0)},children:[(0,ee.jsx)(S.A,{value:"all",children:"All tags"}),((null===(i=de[(null===Ae||void 0===Ae?void 0:Ae.deviceId)||""])||void 0===i?void 0:i.tags)||[]).map(e=>(0,ee.jsx)(S.A,{value:e,children:e},e))]})}),(0,ee.jsx)(w.A,{variant:"outlined",startIcon:(0,ee.jsx)(W.A,{size:16}),onClick:async()=>{var e,i,t;if(!Ae)return;const l=Te?new Date(Te).getTime():Number.NEGATIVE_INFINITY,s=Me?new Date(Me).getTime():Number.POSITIVE_INFINITY,o=oi.filter(e=>{const i=new Date(e.timestamp).getTime();return i>=l&&i<=s}),a={device_alias:null===(e=de[Ae.deviceId])||void 0===e?void 0:e.alias,device_tags:null!==(i=null===(t=de[Ae.deviceId])||void 0===t?void 0:t.tags)&&void 0!==i?i:[],start:Te||null,end:Me||null,entries:o.map(e=>{var i,n,t;return{timestamp:new Date(e.timestamp).toLocaleString(),type:e.type,label:e.label,referenceId:null!==(i=e.referenceId)&&void 0!==i?i:"",status:null!==(n=e.status)&&void 0!==n?n:"",details:null!==(t=e.details)&&void 0!==t?t:""}})};try{const e=(0,Z.x)(n),i=encodeURIComponent(Ae.deviceId),t=["".concat(e,"/api/v1/devices/").concat(i,"/history/export"),"".concat(e,"/api/devices/").concat(i,"/history/export")];let l=null;for(const n of t){const e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(e.ok){const i=await e.blob(),n=URL.createObjectURL(i),t=document.createElement("a");return t.href=n,t.download="device_history_".concat(Ae.deviceId,".pdf"),document.body.appendChild(t),t.click(),document.body.removeChild(t),void URL.revokeObjectURL(n)}l=await e.text()||"HTTP ".concat(e.status)}throw new Error(l||"Unknown error")}catch(r){alert("Failed to export PDF: ".concat(r instanceof Error?r.message:"Unknown error"))}},children:"Export PDF"})]}),0===fe.length?(0,ee.jsx)(v.A,{sx:{color:"#6B7280",fontSize:"14px"},children:"No recorded workflows or modules for this device yet."}):(0,ee.jsxs)(c.A,{sx:{position:"relative",pl:3},children:[(0,ee.jsx)(c.A,{sx:{position:"absolute",left:6,top:0,bottom:0,width:2,backgroundColor:"#E5E7EB"}}),(0,ee.jsxs)(s.A,{spacing:2,children:[ai.map(e=>{const i="success"===e.status?"#16A34A":"#DC2626",n="workflow"===e.type?(0,ee.jsx)(M.A,{size:16}):(0,ee.jsx)(O.A,{size:16});return(0,ee.jsxs)(c.A,{sx:{position:"relative",pl:2},children:[(0,ee.jsx)(c.A,{sx:{position:"absolute",left:-9,top:2,width:16,height:16,borderRadius:"50%",backgroundColor:"#fff",border:"2px solid ".concat(i),display:"flex",alignItems:"center",justifyContent:"center",color:i},children:n}),(0,ee.jsxs)(v.A,{sx:{fontWeight:600,color:"#0F172A"},children:[e.label," ",(0,ee.jsx)(o.A,{label:"success"===e.status?"Success":"Failed",size:"small",sx:{ml:1,backgroundColor:"".concat(i,"1A"),color:i,fontWeight:600}})]}),(0,ee.jsxs)(v.A,{sx:{fontSize:"12px",color:"#6B7280"},children:["workflow"===e.type?"Workflow":"Module"," \u2022 ",ne(e.timestamp)]}),e.details?(0,ee.jsx)(v.A,{sx:{fontSize:"12px",color:"#475569"},children:e.details}):null]},e.id)}),oi.length>Je&&(0,ee.jsxs)(c.A,{display:"flex",justifyContent:"space-between",alignItems:"center",pt:1,children:[(0,ee.jsxs)(v.A,{variant:"body2",sx:{color:"#475569"},children:["Page ",Ve+1," / ",Math.ceil(oi.length/Je)]}),(0,ee.jsxs)(F.A,{size:"small",variant:"outlined",children:[(0,ee.jsx)(w.A,{onClick:()=>He(e=>Math.max(0,e-1)),disabled:0===Ve,children:"Prev"}),(0,ee.jsx)(w.A,{onClick:()=>He(e=>e+1<Math.ceil(oi.length/Je)?e+1:e),disabled:Ve+1>=Math.ceil(oi.length/Je),children:"Next"})]})]})]})]})]}),(0,ee.jsx)(B.A,{children:(0,ee.jsx)(w.A,{onClick:Ze,sx:{textTransform:"none"},children:"Close"})})]})]})}},5059:(e,i,n)=>{n.d(i,{Ll:()=>t,Qt:()=>a,ag:()=>l,xp:()=>r});const t="deviceRegistry",l="deviceRegistry:updated",s=()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return{};try{const e=window.localStorage.getItem(t);if(!e)return{};const i=JSON.parse(e);if(i&&"object"===typeof i)return i}catch(e){console.warn("[deviceRegistry] Failed to read registry",e)}return{}},o=e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{window.localStorage.setItem(t,JSON.stringify(e)),"undefined"!==typeof window&&window.dispatchEvent(new CustomEvent(l))}catch(i){console.warn("[deviceRegistry] Failed to persist registry",i)}},a=()=>s(),r=e=>{if(!e||0===e.length)return;const i=s();let n=!1;const t=(new Date).toISOString();e.forEach(e=>{var l;if(null===e||void 0===e||!e.id)return;const s=i[e.id],o={id:e.id,model:e.model||(null===s||void 0===s?void 0:s.model),connectionType:e.connection_type||(null===s||void 0===s?void 0:s.connectionType),lastStatus:e.status||(null===s||void 0===s?void 0:s.lastStatus),firstSeen:null!==(l=null===s||void 0===s?void 0:s.firstSeen)&&void 0!==l?l:t,lastSeen:t};var a,r;s&&(r=o,(a=s).model===r.model&&a.connectionType===r.connectionType&&a.lastStatus===r.lastStatus&&a.firstSeen===r.firstSeen&&a.lastSeen===r.lastSeen)||(i[e.id]=o,n=!0)}),n&&o(i)}}}]);
//# sourceMappingURL=408.c15829ff.chunk.js.map