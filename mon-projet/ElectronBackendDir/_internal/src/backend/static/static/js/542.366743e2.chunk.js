"use strict";(self.webpackChunktelco_frontend=self.webpackChunktelco_frontend||[]).push([[542],{925:(e,t,n)=>{n.d(t,{Vj:()=>a,hR:()=>d,ld:()=>i,nn:()=>u,uL:()=>s,ww:()=>l,x7:()=>c});var o=n(2555);const i="deviceManagerMetadata",s="deviceMetadataUpdated",r=[{id:"drivers",label:"Drivers installed",done:!1},{id:"usb_debugging",label:"USB debugging enabled",done:!1},{id:"sim_ready",label:"SIM ready",done:!1}],c=e=>{return{alias:"string"===typeof(null===e||void 0===e?void 0:e.alias)?e.alias:"",tags:(n=null===e||void 0===e?void 0:e.tags,Array.isArray(n)?n.filter(e=>"string"===typeof e).map(e=>e.trim()).filter(e=>e.length>0):[]),notes:"string"===typeof(null===e||void 0===e?void 0:e.notes)?e.notes:"",pinned:Boolean(null===e||void 0===e?void 0:e.pinned),checklist:(t=null===e||void 0===e?void 0:e.checklist,Array.isArray(t)?r.map(e=>{const n=t.find(t=>t&&"object"===typeof t&&t.id===e.id);return n?{id:n.id,label:"string"===typeof n.label?n.label:e.label,done:Boolean(n.done)}:(0,o.A)({},e)}):r.map(e=>(0,o.A)({},e)))};var t,n},a=c(),l=()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return{};try{const e=window.localStorage.getItem(i);if(!e)return{};const t=JSON.parse(e);if(!t||"object"!==typeof t)return{};const n={};return Object.entries(t).forEach(e=>{let[t,o]=e;n[t]=c(o)}),n}catch(e){return console.warn("[deviceMetadata] Failed to read metadata",e),{}}},d=e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{window.localStorage.setItem(i,JSON.stringify(e)),window.dispatchEvent(new Event(s))}catch(t){console.warn("[deviceMetadata] Failed to persist metadata",t)}},u=()=>{const e=l(),t={};return Object.entries(e).forEach(e=>{var n;let[o,i]=e;const s=null===(n=i.alias)||void 0===n?void 0:n.trim();s&&(t[o]=s)}),t}},2120:(e,t,n)=>{n.d(t,{HE:()=>a,PS:()=>s,X0:()=>l,wp:()=>c});const o="selectedDeviceIds",i="selectedDeviceId",s="selected-devices:updated",r=e=>{if(!e)return[];if(Array.isArray(e))return e.filter(e=>"string"===typeof e&&e.trim().length>0);if("string"===typeof e)try{const t=JSON.parse(e);if(Array.isArray(t))return r(t)}catch(t){const n=e.trim();if(n.length>0)return[n]}return[]},c=()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return[];try{const e=window.localStorage.getItem(o),t=r(e);if(t.length>0)return Array.from(new Set(t));const n=window.localStorage.getItem(i),s=r(n);if(s.length>0)return a(s),window.localStorage.removeItem(i),s}catch(e){console.warn("[deviceSelection] Failed to read selected devices",e)}return[]},a=e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{const t=Array.from(new Set(e.filter(e=>"string"===typeof e&&e.trim().length>0)));window.localStorage.setItem(o,JSON.stringify(t)),window.dispatchEvent(new CustomEvent(s,{detail:t}))}catch(t){console.warn("[deviceSelection] Failed to persist selected devices",t)}},l=(e,t)=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),Array.from(n)}},5059:(e,t,n)=>{n.d(t,{Ll:()=>o,Qt:()=>c,ag:()=>i,xp:()=>a});const o="deviceRegistry",i="deviceRegistry:updated",s=()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return{};try{const e=window.localStorage.getItem(o);if(!e)return{};const t=JSON.parse(e);if(t&&"object"===typeof t)return t}catch(e){console.warn("[deviceRegistry] Failed to read registry",e)}return{}},r=e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{window.localStorage.setItem(o,JSON.stringify(e)),"undefined"!==typeof window&&window.dispatchEvent(new CustomEvent(i))}catch(t){console.warn("[deviceRegistry] Failed to persist registry",t)}},c=()=>s(),a=e=>{if(!e||0===e.length)return;const t=s();let n=!1;const o=(new Date).toISOString();e.forEach(e=>{var i;if(null===e||void 0===e||!e.id)return;const s=t[e.id],r={id:e.id,model:e.model||(null===s||void 0===s?void 0:s.model),connectionType:e.connection_type||(null===s||void 0===s?void 0:s.connectionType),lastStatus:e.status||(null===s||void 0===s?void 0:s.lastStatus),firstSeen:null!==(i=null===s||void 0===s?void 0:s.firstSeen)&&void 0!==i?i:o,lastSeen:o};var c,a;s&&(a=r,(c=s).model===a.model&&c.connectionType===a.connectionType&&c.lastStatus===a.lastStatus&&c.firstSeen===a.firstSeen&&c.lastSeen===a.lastSeen)||(t[e.id]=r,n=!0)}),n&&r(t)}},6542:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ue});var o=n(2555),i=n(5043),s=n(3216),r=n(6446),c=n(5865),a=n(3845),l=n(7392),d=n(5666),u=n(2143),h=n(5146),x=n(1787),p=n(3336),f=n(1637),g=n(2518),v=n(2110),m=n(6494),w=n(3217),b=n(9508),A=n(9216),y=n(5721),S=n(1322),j=n(2050),k=n(8734),C=n(35),F=n(6600),E=n(5316),z=n(9347),D=n(2054),_=n(7719),W=n(516),T=n(1885),B=n(4830),I=n(687),R=n(6692),L=n(4105),M=n(73),O=n(6963),N=n(7856),P=n(9292),U=n(9917),H=n(4991),G=n(5505),J=n(3156),q=n(9463),K=n(8326),Q=n(8729),V=n(7426),Y=n(2120),X=n(9074),Z=n(6593),$=n(8354),ee=n(925),te=n(5059);const ne=new class{track(e,t){if("undefined"!==typeof window){try{var n;if(null!==(n=window.electronAPI)&&void 0!==n&&n.trackEvent)return void window.electronAPI.trackEvent(e,null!==t&&void 0!==t?t:{});if(((e,t)=>{if("undefined"===typeof navigator||"function"!==typeof navigator.sendBeacon)return!1;try{const n=new Blob([JSON.stringify({event:e,payload:t,ts:(new Date).toISOString()})],{type:"application/json"});return navigator.sendBeacon("/api/v1/telemetry",n),!0}catch(n){return!1}})(e,t))return}catch(o){return void console.debug("[telemetry] failed to send event",e,o)}console.debug("[telemetry]",e,null!==t&&void 0!==t?t:{})}}};var oe=n(579);const ie="dashboardDisconnectedDevices",se="dashboardActivityClearedAt",re={radius:16,spacing:24,card:{padding:20,elevation:6},colors:{bg:"#F7FAFC",panel:"#FFFFFF",text:"#1A202C",subtext:"#4A5568",primary:"#2563EB",success:"#16A34A",warning:"#D97706",danger:"#DC2626",border:"#E2E8F0",mutedBorder:"#CBD5F5",accent:"#EEF2FF"},shadows:{card:"0 8px 24px rgba(0,0,0,0.06)",cardHover:"0 12px 32px rgba(0,0,0,0.08)"}},ce={backgroundColor:re.colors.panel,border:"1px solid ".concat(re.colors.border),borderRadius:"".concat(re.radius,"px"),boxShadow:re.shadows.card,transition:"all 0.2s ease-in-out"},ae={"&:hover":{boxShadow:re.shadows.cardHover,transform:"translateY(-2px)"}},le={fontSize:"16px",lineHeight:"24px",fontWeight:600,color:re.colors.text},de=(re.colors.subtext,function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=e.trim().toLowerCase();if(!o)return[];const i=[],s=t.filter(e=>[n[e.id],e.model,e.id,e.network_operator,e.network_technology].filter(Boolean).map(e=>String(e).toLowerCase()).some(e=>e.includes(o))).slice(0,4).map(e=>{var t;const o=n[e.id],i=e.model||e.id,s=null!==(t=e.status)&&void 0!==t?t:"unknown";return{type:"device",id:e.id,label:o?"".concat(o," \u2022 ").concat(i," (").concat(s,")"):"".concat(i," (").concat(s,")"),href:"/devices/".concat(e.id)}});return i.push(...s),i.slice(0,8)}),ue=e=>{var t;let{backendUrl:n}=e;const{devices:ue,status:he,error:xe,refresh:pe}=(0,Q.t)({backendUrl:n,pollMs:2e3}),[fe,ge]=(0,i.useState)(""),ve=(0,s.Zp)(),me=(0,s.zy)(),[we,be]=(0,i.useState)(()=>(()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return new Set;try{const e=window.localStorage.getItem(ie);if(!e)return new Set;const t=JSON.parse(e);if(Array.isArray(t))return new Set(t.filter(e=>"string"===typeof e))}catch(xe){console.warn("[Dashboard] Failed to read disconnected devices cache",xe)}return new Set})()),[Ae,ye]=(0,i.useState)(null),[Se,je]=(0,i.useState)(!1),[ke,Ce]=(0,i.useState)(()=>(0,V.WF)()),[Fe,Ee]=(0,i.useState)(()=>(0,Y.wp)()),[ze,De]=(0,i.useState)([]),[_e,We]=(0,i.useState)(!1),[Te,Be]=(0,i.useState)(!1),[Ie,Re]=(0,i.useState)([]),[Le,Me]=(0,i.useState)(!1),[Oe,Ne]=(0,i.useState)(0),[Pe,Ue]=(0,i.useState)(!1),[He,Ge]=(0,i.useState)(()=>"undefined"===typeof window?null:(()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return null;try{const e=window.localStorage.getItem(se);if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null}catch(e){return null}})()),[Je,qe]=(0,i.useState)(!1),[Ke,Qe]=(0,i.useState)(!1),[Ve,Ye]=(0,i.useState)(null),[Xe,Ze]=(0,i.useState)(null),[$e,et]=(0,i.useState)(!1),[tt,nt]=(0,i.useState)(0),[ot,it]=(0,i.useState)(null),[st,rt]=(0,i.useState)(()=>(0,ee.nn)()),[ct,at]=(0,i.useState)(null),[lt,dt]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(0,te.xp)(ue)},[ue]),(0,i.useEffect)(()=>{ne.track("dashboard_viewed",{scopeId:"default"})},[]),(0,i.useEffect)(()=>{(e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{0===e.size?window.localStorage.removeItem(ie):window.localStorage.setItem(ie,JSON.stringify(Array.from(e.values())))}catch(xe){console.warn("[Dashboard] Failed to persist disconnected devices cache",xe)}})(we)},[we]),(0,i.useEffect)(()=>{if("undefined"===typeof window)return;const e=()=>rt((0,ee.nn)()),t=t=>{t.key===ee.ld&&e()};return window.addEventListener(ee.uL,e),window.addEventListener("storage",t),()=>{window.removeEventListener(ee.uL,e),window.removeEventListener("storage",t)}},[]),(0,i.useEffect)(()=>{if("undefined"===typeof window)return;const e=e=>{e.key===ie&&be((e=>{if(!e)return new Set;try{const t=JSON.parse(e);if(Array.isArray(t))return new Set(t.filter(e=>"string"===typeof e))}catch(t){}return new Set})(e.newValue))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[]);const ut=(0,i.useRef)(null),ht=(0,i.useRef)(null),xt=(0,i.useRef)(null),pt=(0,i.useRef)(null),ft=(0,i.useMemo)(()=>n?(0,X.x)(n):null,[n]),gt=(0,i.useMemo)(()=>(0,$.XK)(),[tt]),vt=(0,i.useCallback)((e,t)=>{var n,o;const i=e.trim();i&&pt.current!==i&&(pt.current=i,ne.track("search_used",{queryLength:i.length,resultTypeTop:null!==(n=null===(o=t[0])||void 0===o?void 0:o.type)&&void 0!==n?n:"none"}))},[]),mt=(0,i.useCallback)(e=>{Ee(t=>{const n=e(t);return t.join(",")!==n.join(",")?((0,Y.HE)(n),n):t})},[]),wt=(0,i.useCallback)((e,t)=>{var n;const i=(0,ee.ww)(),s=(0,ee.x7)(null!==(n=i[e])&&void 0!==n?n:ee.Vj),r=(0,o.A)((0,o.A)({},i),{},{[e]:(0,ee.x7)((0,o.A)((0,o.A)({},s),{},{alias:t}))});(0,ee.hR)(r),rt(n=>{const i=(0,o.A)({},n),s=t.trim();return s?i[e]=s:delete i[e],i})},[]);(0,i.useEffect)(()=>{const e=()=>Ce((0,V.WF)());return e(),window.addEventListener(V.WK,e),()=>{window.removeEventListener(V.WK,e)}},[]),(0,i.useEffect)(()=>{const e=e=>{const t=e;Array.isArray(t.detail)?Ee(e=>e.join(",")===t.detail.join(",")?e:t.detail):Ee((0,Y.wp)())};return window.addEventListener(Y.PS,e),()=>{window.removeEventListener(Y.PS,e)}},[]),(0,i.useEffect)(()=>{const e=()=>{nt(e=>e+1)};return window.addEventListener($.b4,e),()=>{window.removeEventListener($.b4,e)}},[]);const bt=(0,i.useCallback)(()=>{const e=[];return Object.entries(gt).forEach(t=>{let[n,o]=t;o.forEach((t,o)=>{if(!t.executedAt)return;const i="history-".concat(n,"-").concat(o,"-").concat(t.executedAt);e.push({id:i,icon:"check",title:"".concat(t.workflowName||"Workflow"," on ").concat(n),ts:t.executedAt,meta:en(t.executedAt)})})}),ke.forEach(t=>{t.lastRunAt&&e.push({id:"workflow-".concat(t.id,"-").concat(t.lastRunAt),icon:"info",title:"".concat(t.name," executed"),ts:t.lastRunAt,meta:en(t.lastRunAt)})}),e.sort((e,t)=>{const n=e.ts?new Date(e.ts).getTime():0;return(t.ts?new Date(t.ts).getTime():0)-n}),e},[gt,ke]);(0,i.useEffect)(()=>{const e=new AbortController,t=async()=>{if(!ft)return null;try{const n=await fetch("".concat(ft,"/api/dashboard/activity/recent"),{signal:e.signal});if(!n.ok)throw new Error("HTTP ".concat(n.status));const o=await n.json();return t=o.items||[],(Array.isArray(t)?t:[]).map((e,t)=>{var n,o,i,s,r;const c=null!==(n=null===e||void 0===e?void 0:e.ts)&&void 0!==n?n:null;return{id:null!==(o=null===e||void 0===e?void 0:e.id)&&void 0!==o?o:"activity-".concat(t),icon:null!==(i=null===e||void 0===e?void 0:e.icon)&&void 0!==i?i:"info",title:null!==(s=null===e||void 0===e?void 0:e.title)&&void 0!==s?s:"Workflow update",ts:c,meta:null!==(r=null===e||void 0===e?void 0:e.meta)&&void 0!==r?r:c?en(c):void 0}})}catch(xe){e.signal.aborted||console.warn("[Dashboard] Failed to fetch /activity/recent",xe)}var t;return null},n=async()=>{if(!ft)return null;try{const t=await fetch("".concat(ft,"/api/v1/executions"),{signal:e.signal});if(!t.ok)throw new Error("HTTP ".concat(t.status));const n=await t.json();return(e=>{const t=e=>{const t=(e||"").toLowerCase();return"completed"===t||"success"===t?"check":"failed"===t||"error"===t?"warning":"cancelled"===t?"ban":"loader"};return(Array.isArray(e)?e:[]).map((e,n)=>{var o,i,s,r,c,a;const l=null!==(o=null!==(i=null===e||void 0===e?void 0:e.status)&&void 0!==i?i:null===e||void 0===e?void 0:e.state)&&void 0!==o?o:"completed",d=(null===e||void 0===e?void 0:e.flow_name)||(null===e||void 0===e||null===(s=e.flow)||void 0===s?void 0:s.name)||(null===e||void 0===e?void 0:e.flow_id)||(null===e||void 0===e||null===(r=e.flow)||void 0===r?void 0:r.id)||"Workflow",u=null!==e&&void 0!==e&&e.device_id?" on ".concat(e.device_id):"",h=(null===e||void 0===e?void 0:e.updated_at)||(null===e||void 0===e?void 0:e.end_time)||(null===e||void 0===e?void 0:e.start_time)||(null===e||void 0===e?void 0:e.created_at)||null;return{id:null!==(c=null!==(a=null===e||void 0===e?void 0:e.execution_id)&&void 0!==a?a:null===e||void 0===e?void 0:e.id)&&void 0!==c?c:"exec-".concat(n),icon:t(l),title:"".concat(d," ").concat(String(l).toLowerCase()).concat(u),ts:h,meta:h?en(h):void 0}}).sort((e,t)=>{const n=e.ts?new Date(e.ts).getTime():0;return(t.ts?new Date(t.ts).getTime():0)-n})})(Array.isArray(n)?n:[])}catch(xe){e.signal.aborted||console.warn("[Dashboard] Failed to fetch executions for activity",xe)}return null};return(async()=>{Me(!0);let o=null;if(ft&&(o=await t(),o&&0!==o.length||e.signal.aborted||(o=await n())),o&&0!==o.length||e.signal.aborted||(o=bt()),!e.signal.aborted){var i;const e=(s=null!==(i=o)&&void 0!==i?i:[],(r=He)?s.filter(e=>{if(!e.ts)return!1;const t=new Date(e.ts).getTime();return!Number.isNaN(t)&&t>r}):s),t=e.length>20?e.slice(0,20):e;Re(t),Ne(0),Ue(!1),Me(!1)}var s,r})(),()=>e.abort()},[ft,bt,He]),(0,i.useEffect)(()=>{Pe||Ne(e=>{const t=Math.max(0,Math.ceil(Ie.length/4)-1);return e>t?t:e})},[Ie.length,Pe]),(0,i.useEffect)(()=>{const e=e=>{xt.current&&(xt.current.contains(e.target)||Be(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,i.useEffect)(()=>{null!==ut.current&&(window.clearTimeout(ut.current),ut.current=null),ht.current&&(ht.current.abort(),ht.current=null);const e=fe.trim();if(!e)return De([]),Be(!1),We(!1),void(pt.current=null);if(Be(!0),!ft){We(!1);const t=de(e,ue,st);return De(t),void vt(e,t)}We(!0);const t=new AbortController;return ht.current=t,ut.current=window.setTimeout(async()=>{try{const n=await fetch("".concat(ft,"/api/dashboard/search?q=").concat(encodeURIComponent(e),"&limit=8"),{signal:t.signal});if(!n.ok)throw new Error("HTTP ".concat(n.status));const o=await n.json(),i=(Array.isArray(o.results)?o.results:[]).filter(e=>{var t;return"device"===(null!==(t=null===e||void 0===e?void 0:e.type)&&void 0!==t?t:"device")});if(i.length>0)De(i),vt(e,i);else{const t=de(e,ue,st);De(t),vt(e,t)}}catch(n){if(t.signal.aborted)return;console.warn("[Dashboard] Search failed, falling back to local results",n);const o=de(e,ue,st);De(o),vt(e,o)}finally{t.signal.aborted||We(!1)}},350),()=>{t.abort(),null!==ut.current&&(window.clearTimeout(ut.current),ut.current=null)}},[fe,ft,ue,vt,st]);const At=e=>e?e.toLowerCase():"unknown",yt=["connected","online","busy"],St=["idle"],jt=e=>{if(!e)return null;const t=String(e).trim();if(!t||"unknown"===t.toLowerCase())return null;if(t.includes("NetworkRegistrationInfo")||t.includes("mOperatorAlphaShort")||t.startsWith("null"))return null;const n=t.split(",")[0].trim();return n&&"null"!==n.toLowerCase()?n:null},kt=e=>{var t;const n=[e.network_operator,e.carrier,null===e||void 0===e||null===(t=e.sim_info)||void 0===t?void 0:t.carrier];for(const o of n){const e=jt(o);if(e)return e}return"Not detected"},Ct=e=>{if(!e)return"Unknown";const t={lte:"4G","lte-ca":"4G+",gsm:"2G",gprs:"2G",edge:"2G","cdma-evdo":"3G",evdo:"3G",evdo0:"3G",evdoa:"3G",evdob:"3G",e_hrpd:"3G",umts:"3G",wcdma:"3G",hspa:"3G",hsupa:"3G",hsupa_:"3G",hsdpa:"3G",hspap:"3G",tdscdma:"3G",nr:"5G","nr-nsa":"5G","nr-sa":"5G","nr/mmwave":"5G"}[e.toLowerCase()];return t?"".concat(t," (").concat(e.toUpperCase(),")"):(/^(2g|3g|4g|5g|6g)$/i.test(e),e.toUpperCase())},Ft=(0,i.useMemo)(()=>{const e=Math.ceil(Ie.length/4);return Math.max(1,e||0)},[Ie.length]),Et=(0,i.useMemo)(()=>{if(Pe)return Ie;const e=4*Oe;return Ie.slice(e,e+4)},[Ie,Oe,Pe]),zt=!Pe&&Oe>0,Dt=!Pe&&4*(Oe+1)<Ie.length,_t=4*Oe,Wt=Math.min(Ie.length,_t+4),Tt=Math.max(0,Wt-_t),Bt=(0,i.useMemo)(()=>ue.filter(e=>{const t=At(e.status);return yt.includes(t)||St.includes(t)}),[ue]),It=(0,i.useMemo)(()=>[],[]),Rt=fe.trim().toLowerCase(),Lt=Bt.filter(e=>{var t,n,o,i;if(!Rt)return!0;return(null!==(t=null===(n=st[e.id])||void 0===n?void 0:n.toLowerCase())&&void 0!==t?t:"").includes(Rt)||(null===(o=e.model)||void 0===o?void 0:o.toLowerCase().includes(Rt))||(null===(i=e.id)||void 0===i?void 0:i.toLowerCase().includes(Rt))}),Mt=(0,i.useMemo)(()=>Bt.filter(e=>!we.has(e.id)),[Bt,we]),Ot=(0,i.useMemo)(()=>Mt.map(e=>e.id),[Mt]),Nt=(0,i.useMemo)(()=>new Set(Fe),[Fe]),Pt=(0,i.useMemo)(()=>Bt.map(e=>e.id),[Bt]),Ut=Pt.length>0&&Pt.every(e=>Nt.has(e)),Ht=Pt.some(e=>Nt.has(e))&&!Ut,Gt=Mt.filter(e=>yt.includes(At(e.status))).length,Jt=Bt.length,qt=ke.filter(e=>e.runCount>0).length,Kt=ke.length-qt,Qt=ke.reduce((e,t)=>e+(t.runCount||0),0);(0,i.useEffect)(()=>{if("success"!==he)return;const e=new Set(Ot);if(Fe.length>0){const t=Fe.filter(t=>e.has(t));if(t.length!==Fe.length){const e=Fe.length-t.length;return Ze({severity:0===t.length?"warning":"info",message:0===t.length?"Active device disconnected. Selection cleared.":"Removed ".concat(e," disconnected device").concat(e>1?"s":""," from the selection.")}),void mt(()=>t)}}if(0===Fe.length&&1===Ot.length){const e=Ot[0],t=Mt.find(t=>t.id===e);t&&Ze({severity:"info",message:"".concat(t.model||t.id," automatically selected as the active device.")}),mt(()=>[e])}},[Ot,Mt,Fe,he,mt]);const Vt=e=>{ye(e),je(!0)},Yt=()=>it(null),Xt=e=>{if(Yt(),"about"===e)return void Qe(!0);"updates"===e&&Ze({severity:"info",message:"Opening the releases page in a new tab."});const t={faq:"https://github.com/Specpapers/ADB-automation-tool/wiki/FAQ",updates:"https://github.com/Specpapers/ADB-automation-tool/releases",manual:"https://github.com/Specpapers/ADB-automation-tool/wiki/User-Manual"}[e];window.open(t,"_blank","noopener,noreferrer")},Zt=e=>{const t=[];!1===e.developer_mode_enabled&&t.push("Enable developer options"),!1===e.usb_debugging_enabled&&t.push("Enable USB debugging");const n=[e.raw_status,e.raw_adb_status,e.adb_status,e.status].filter(e=>"string"===typeof e).map(e=>e.toLowerCase());return n.some(e=>e.includes("unauthorized"))&&t.push("Authorize this computer"),n.some(e=>e.includes("offline"))&&t.push("Reconnect the device"),t.length>0?t.join(" \u2022 "):"Device not ready"},$t=((0,i.useMemo)(()=>{const e=ue.map(e=>{const t=(e=>{if("number"===typeof e&&Number.isFinite(e))return Math.max(0,Math.min(100,Math.round(e)));if("string"===typeof e){const t=parseInt(e.replace("%","").trim(),10);if(Number.isFinite(t))return Math.max(0,Math.min(100,t))}return null})(e.battery_level);return null===t?null:{device:e,level:t}}).filter(Boolean);if(0===e.length)return{average:null,count:0,lowest:[]};const t=Math.round(e.reduce((e,t)=>e+t.level,0)/e.length),n=[...e].sort((e,t)=>e.level-t.level).slice(0,3);return{average:t,count:e.length,lowest:n}},[ue]),async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"header";if(!$e){ne.track("scan_again_clicked",{origin:e,deviceCount:ue.length}),et(!0);try{n&&await Z.D.scanDevices(n),await pe(),Ze({severity:"success",message:"Devices synchronized with the backend."})}catch(xe){const t=xe instanceof Error?xe.message:"Failed to refresh devices.";Ze({severity:"error",message:t})}finally{et(!1)}}}),en=e=>{if(!e)return"Just now";const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return"Just now";const n=Math.max(0,Math.floor((Date.now()-t.getTime())/1e3));if(n<60)return n<=1?"Just now":"".concat(n," seconds ago");const o=Math.floor(n/60);if(o<60)return 1===o?"1 minute ago":"".concat(o," minutes ago");const i=Math.floor(o/60);if(i<24)return 1===i?"1 hour ago":"".concat(i," hours ago");const s=Math.floor(i/24);if(s<7)return 1===s?"1 day ago":"".concat(s," days ago");const r=Math.floor(s/7);return 1===r?"1 week ago":"".concat(r," weeks ago")},tn=e=>{switch(e.icon){case"check":return(0,oe.jsx)(D.A,{size:20});case"warning":return(0,oe.jsx)(_.A,{size:20});case"loader":return(0,oe.jsx)(W.A,{size:20});default:return(0,oe.jsx)(T.A,{size:20})}},nn=(0,i.useMemo)(()=>[{icon:(0,oe.jsx)(B.A,{size:16}),label:"Quick Test (".concat(Fe.length," selected)"),active:Fe.length>0,path:"/modules"},{icon:(0,oe.jsx)(I.A,{size:16}),label:"Workflows",active:!1,path:"/workflows"},{icon:(0,oe.jsx)(R.A,{size:16}),label:"Modules",active:!1,path:"/modules"}],[Fe.length]),on=(0,i.useCallback)(e=>{var t;at({deviceId:e.id,value:null!==(t=st[e.id])&&void 0!==t?t:"",name:st[e.id]||e.model||e.id})},[st]),sn=(0,i.useCallback)(()=>{lt||at(null)},[lt]),rn=(0,i.useCallback)(()=>{if(!ct)return;const e=ct.value.trim();dt(!0);try{wt(ct.deviceId,e),Ze({severity:"success",message:e?"Alias saved for ".concat(ct.name,"."):"Alias removed for ".concat(ct.name,".")}),at(null)}catch(xe){console.warn("[Dashboard] Failed to persist alias",xe),Ze({severity:"error",message:"Unable to save alias. Please try again."})}finally{dt(!1)}},[ct,wt]),cn=(0,i.useCallback)(e=>{at(t=>t?(0,o.A)((0,o.A)({},t),{},{value:e}):t)},[]);return(0,oe.jsxs)(r.A,{sx:{display:"flex",minHeight:"100vh",backgroundColor:re.colors.bg,fontFamily:'Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif'},children:[(0,oe.jsxs)(r.A,{sx:{width:280,background:"linear-gradient(180deg, #0D1B2A 0%, #152238 100%)",padding:"16px 12px",display:"flex",flexDirection:"column",position:"sticky",top:0,height:"100vh"},children:[(0,oe.jsxs)(r.A,{sx:{mb:4,pb:2,borderBottom:"1px solid rgba(255, 255, 255, 0.08)"},children:[(0,oe.jsx)(c.A,{variant:"h6",sx:{color:"rgba(255, 255, 255, 0.9)",fontWeight:700,fontSize:"18px",lineHeight:"26px"},children:"MOBIQ"}),(0,oe.jsx)(c.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"12px",lineHeight:"18px"},children:"The Future of Telecom Automation"})]}),(0,oe.jsx)(r.A,{sx:{flex:1},children:[{label:"Dashboard",icon:(0,oe.jsx)(L.A,{size:20}),path:"/dashboard"},{label:"Modules",icon:(0,oe.jsx)(R.A,{size:20}),path:"/modules"},{label:"Workflows",icon:(0,oe.jsx)(M.A,{size:20}),path:"/workflows"},{label:"Device Manager",icon:(0,oe.jsx)(O.A,{size:20}),path:"/devices"}].map((e,t)=>{const n=me.pathname===e.path;return(0,oe.jsxs)(r.A,{onClick:()=>ve(e.path),sx:{height:48,borderRadius:"12px",padding:"0 14px",display:"flex",alignItems:"center",gap:2,mb:1,cursor:"pointer",backgroundColor:n?"#1E3A8A":"transparent",color:n?"#FFFFFF":"#D1D5DB","&:hover":{backgroundColor:n?"#1E3A8A":"#11253F",color:n?"#FFFFFF":"#E5E7EB"}},children:[(0,oe.jsx)(r.A,{sx:{color:n?"#FFFFFF":"#93C5FD"},children:e.icon}),(0,oe.jsx)(c.A,{sx:{fontSize:"14px",fontWeight:500},children:e.label})]},t)})}),(0,oe.jsxs)(r.A,{sx:{textAlign:"center",mt:2},children:[(0,oe.jsxs)(r.A,{sx:{display:"inline-flex",alignItems:"center",gap:1},children:[(0,oe.jsx)(a.A,{label:"MOBIQ v1.0",size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.7)",fontSize:"11px"}}),(0,oe.jsx)(l.A,{size:"small",onClick:e=>{it(e.currentTarget)},sx:{color:"rgba(255, 255, 255, 0.8)"},children:(0,oe.jsx)(N.A,{size:16})})]}),(0,oe.jsxs)(d.A,{anchorEl:ot,open:Boolean(ot),onClose:Yt,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},children:[(0,oe.jsx)(u.A,{onClick:()=>Xt("about"),children:"About"}),(0,oe.jsx)(u.A,{onClick:()=>Xt("faq"),children:"FAQ"}),(0,oe.jsx)(u.A,{onClick:()=>Xt("updates"),children:"Check for updates"}),(0,oe.jsx)(u.A,{onClick:()=>Xt("manual"),children:"User manual"})]})]})]}),(0,oe.jsxs)(r.A,{sx:{flex:1,padding:"24px 28px",maxWidth:1320,margin:"0 auto"},children:[(0,oe.jsxs)(r.A,{sx:{height:56,display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,oe.jsx)(r.A,{sx:{height:48,width:48,borderRadius:"14px",background:"linear-gradient(135deg, #0F172A 0%, #0EA5E9 50%, #7C3AED 100%)",display:"grid",placeItems:"center",boxShadow:"0 10px 30px rgba(14, 165, 233, 0.28)"},children:(0,oe.jsx)(L.A,{size:22,color:"#FFFFFF"})}),(0,oe.jsx)(c.A,{variant:"h1",sx:{fontSize:"28px",lineHeight:"36px",fontWeight:800,color:"#0F172A",letterSpacing:"-0.01em"},children:"Dashboard"})]}),(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,oe.jsxs)(r.A,{ref:xt,sx:{position:"relative",width:460},children:[(0,oe.jsx)(h.A,{placeholder:"Search devices\u2026",value:fe,onChange:e=>ge(e.target.value),onFocus:()=>fe.trim()&&Be(!0),sx:{width:"100%","& .MuiOutlinedInput-root":{height:40,borderRadius:"10px","& fieldset":{borderColor:"#E5E7EB"}}},InputProps:{startAdornment:(0,oe.jsx)(x.A,{position:"start",children:(0,oe.jsx)(P.A,{size:20,color:"#6B7280"})})}}),Te&&(0,oe.jsx)(p.A,{elevation:3,sx:{position:"absolute",top:44,left:0,right:0,borderRadius:"12px",overflow:"hidden",zIndex:20,maxHeight:320,display:"flex",flexDirection:"column"},onMouseDown:e=>e.preventDefault(),children:_e?(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:1.5,padding:"12px 16px"},children:[(0,oe.jsx)(f.A,{size:18}),(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#475569"},children:"Searching\u2026"})]}):0===ze.length?(0,oe.jsx)(r.A,{sx:{padding:"12px 16px"},children:(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280"},children:"No devices found."})}):ze.map(e=>(0,oe.jsxs)(r.A,{onClick:()=>(e=>{if(Be(!1),"device"===e.type){const t=ue.find(t=>t.id===e.id);t&&Vt(t)}e.href&&ve(e.href)})(e),sx:{padding:"12px 16px",display:"flex",flexDirection:"column",gap:.5,cursor:"pointer","&:hover":{backgroundColor:"#EEF2FF"}},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",fontWeight:600,color:"#0F172A"},children:e.label}),(0,oe.jsx)(c.A,{sx:{fontSize:"12px",color:"#6B7280"},children:"Device"})]},"".concat(e.type,"-").concat(e.id)))})]}),(0,oe.jsx)(g.A,{variant:"contained",startIcon:(0,oe.jsx)(W.A,{size:18}),onClick:()=>$t("header"),disabled:$e,sx:{height:40,borderRadius:"12px",backgroundColor:$e?"#94A3B8":"#1E293B",textTransform:"none",fontWeight:600,"&:hover":{backgroundColor:$e?"#94A3B8":"#0F172A"}},children:$e?"Refreshing\u2026":"Refresh"}),(0,oe.jsx)(g.A,{variant:"contained",startIcon:(0,oe.jsx)(L.A,{size:20}),onClick:()=>{ne.track("add_devices_clicked",{requiresSetup:It.length}),qe(!0)},sx:{height:40,borderRadius:"12px",backgroundColor:"linear-gradient(135deg, #2563EB 0%, #1E40AF 100%)",background:"linear-gradient(135deg, #2563EB 0%, #1E40AF 100%)",textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(37, 99, 235, 0.3)",transition:"all 0.2s ease-in-out","&:hover":{background:"linear-gradient(135deg, #1E40AF 0%, #1E3A8A 100%)",boxShadow:"0 6px 16px rgba(37, 99, 235, 0.4)",transform:"translateY(-1px)"}},children:"Add Devices"})]})]}),(0,oe.jsxs)(r.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:3,mb:3},children:[(0,oe.jsx)(v.A,{sx:(0,o.A)((0,o.A)({},ce),ae),children:(0,oe.jsxs)(m.A,{sx:{padding:"".concat(re.card.padding,"px ").concat(re.spacing,"px")},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:re.colors.text,mb:2},children:"Connected Devices"}),(0,oe.jsxs)(c.A,{sx:{fontSize:"48px",fontWeight:700,color:re.colors.text,lineHeight:1},children:[Gt,"/",Jt]}),(0,oe.jsxs)(c.A,{sx:{fontSize:"12px",lineHeight:"18px",fontWeight:500,color:re.colors.subtext,mt:1},children:[Gt," active"]})]})}),(0,oe.jsx)(v.A,{sx:(0,o.A)((0,o.A)({},ce),ae),children:(0,oe.jsxs)(m.A,{sx:{padding:"".concat(re.card.padding,"px ").concat(re.spacing,"px")},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:re.colors.text,mb:2},children:"Workflows"}),(0,oe.jsx)(c.A,{sx:{fontSize:"48px",fontWeight:700,color:re.colors.text,lineHeight:1},children:ke.length}),(0,oe.jsxs)(c.A,{sx:{fontSize:"12px",lineHeight:"18px",fontWeight:500,color:re.colors.subtext,mt:1},children:[qt," active | ",Kt," draft | ",Qt," run",1===Qt?"":"s"]})]})}),(0,oe.jsx)(v.A,{sx:(0,o.A)((0,o.A)({},ce),ae),children:(0,oe.jsxs)(m.A,{sx:{padding:"".concat(re.card.padding,"px ").concat(re.spacing,"px")},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:re.colors.text,mb:2},children:"Quick Actions"}),(0,oe.jsx)(r.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:nn.map((e,t)=>(0,oe.jsxs)(r.A,{onClick:()=>e.path&&ve(e.path),sx:{height:44,borderRadius:"12px",padding:"0 14px",display:"flex",alignItems:"center",gap:2,cursor:"pointer",backgroundColor:e.active?re.colors.accent:"transparent",color:e.active?re.colors.primary:re.colors.text,border:"1px solid ".concat(e.active?re.colors.primary:re.colors.border),transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:e.active?re.colors.accent:re.colors.panel,boxShadow:re.shadows.card}},children:[(0,oe.jsx)(r.A,{sx:{width:28,height:28,borderRadius:"50%",display:"grid",placeItems:"center",backgroundColor:e.active?re.colors.primary:re.colors.accent,color:e.active?"#FFFFFF":re.colors.primary},children:e.icon}),(0,oe.jsx)(c.A,{sx:{fontSize:"14px",fontWeight:500,flex:1},children:e.label})]},t))})]})})]}),(0,oe.jsxs)(r.A,{sx:{display:"grid",gridTemplateColumns:"2fr 1fr",gap:3},children:[(0,oe.jsx)(v.A,{sx:(0,o.A)((0,o.A)((0,o.A)({},ce),ae),{},{minHeight:420}),children:(0,oe.jsxs)(m.A,{sx:{padding:"".concat(re.card.padding,"px ").concat(re.spacing,"px")},children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,oe.jsx)(c.A,{sx:le,children:"Connected Devices"}),(0,oe.jsx)(a.A,{label:"".concat(Fe.length," device").concat(1===Fe.length?"":"s"," selected"),size:"small",sx:{backgroundColor:re.colors.accent,color:re.colors.primary,fontWeight:600,height:24}})]}),Bt.length>0&&(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,oe.jsx)(w.A,{size:"small",checked:Ut&&Pt.length>0,indeterminate:Ht,onChange:()=>{mt(e=>{if(0===Pt.length)return e;if(Ut){const t=new Set(Pt);return e.filter(e=>!t.has(e))}const t=new Set(e);return Pt.forEach(e=>t.add(e)),Array.from(t)})},sx:{padding:0}}),(0,oe.jsx)(c.A,{sx:{fontSize:"12px",color:re.colors.primary,fontWeight:600},children:"Select all"})]})]}),0===Bt.length?(0,oe.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",py:8},children:[(0,oe.jsx)(O.A,{size:56,color:"#6B7280",style:{marginBottom:16}}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:re.colors.text,mb:1},children:"No devices connected"}),(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:re.colors.subtext,mb:3,maxWidth:280},children:"Connect an Android device via USB and enable USB debugging"}),(0,oe.jsx)(g.A,{variant:"contained",startIcon:(0,oe.jsx)(W.A,{size:16}),onClick:()=>$t("empty"),disabled:$e,sx:{height:44,borderRadius:"12px",backgroundColor:$e?"#94A3B8":re.colors.primary,textTransform:"none",fontWeight:600,"&:hover":{backgroundColor:$e?"#94A3B8":"#1E48C7"}},children:$e?"Scanning\u2026":"Scan Again"})]}):(0,oe.jsxs)(r.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:2},children:[Lt.slice(0,12).map(e=>{var t;const o=Nt.has(e.id),i=we.has(e.id),s=!0===e.requires_setup,d=!i,u=(null===(t=st[e.id])||void 0===t?void 0:t.trim())||"",h=e.model||e.id,x=u||e.id,p=At(e.status),f=i?"Disconnected":"busy"===p?"Busy":(e.status||"Connected").toString(),v=i?re.colors.danger:"busy"===p?re.colors.warning:re.colors.success,m=o?"#2563EB":i?"#DC2626":"#E5E7EB";return(0,oe.jsxs)(r.A,{sx:{p:2,background:"#F8FAFC",borderRadius:"10px",border:"2px solid ".concat(m),boxShadow:o?"0 4px 12px rgba(37, 99, 235, 0.15)":"none",transition:"all 0.2s ease-in-out",opacity:i?.6:1,"&:hover":{boxShadow:"0 2px 8px rgba(16, 24, 40, 0.1)",transform:"translateY(-1px)"}},children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,oe.jsx)(a.A,{label:f,size:"small",sx:{backgroundColor:"".concat(v,"1A"),color:v,fontSize:"10px",fontWeight:600,textTransform:"capitalize"}}),s&&(0,oe.jsx)(b.A,{title:"Developer options or USB debugging disabled",children:(0,oe.jsx)(a.A,{label:"Setup",size:"small",sx:{backgroundColor:"#FEF3C7",color:"#B45309",fontSize:"9px",fontWeight:600,textTransform:"uppercase"}})}),(0,oe.jsx)(b.A,{title:d?o?"Active target":"Set as active target":"Device unavailable",children:(0,oe.jsx)("span",{children:(0,oe.jsx)(l.A,{size:"small",onClick:()=>(e=>{we.has(e.id)?Ze({severity:"error",message:"Reconnect the device before using it for tests."}):mt(t=>(0,Y.X0)(t,e.id))})(e),disabled:!d,sx:{width:28,height:28,borderRadius:"6px",backgroundColor:o?"#2563EB":"#FFFFFF",border:"1px solid ".concat(o?"#2563EB":"#CBD5F5"),color:o?"#FFFFFF":"#64748B","&:hover":{backgroundColor:d?"#1E48C7":"#FFFFFF",color:d?"#FFFFFF":"#94A3B8"}},children:o?(0,oe.jsx)(U.A,{size:16}):(0,oe.jsx)(H.A,{size:16})})})})]}),(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,oe.jsx)(r.A,{sx:{background:i?"#FEF2F2":"#ECFDF5",borderRadius:"6px",p:.5,color:i?"#DC2626":"#16A34A"},children:(0,oe.jsx)(O.A,{size:16})}),(0,oe.jsxs)(r.A,{flex:1,sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"space-between"},children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column"},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",fontWeight:600,color:"#0F172A"},children:h}),(0,oe.jsx)(c.A,{sx:{fontSize:"11px",color:"#6B7280",fontWeight:u?600:400},children:x})]}),(0,oe.jsx)(b.A,{title:u?"Edit alias":"Add alias",children:(0,oe.jsx)(l.A,{size:"small",onClick:()=>on(e),sx:{width:24,height:24,borderRadius:"6px",backgroundColor:"#F1F5F9",color:"#475569",ml:"auto","&:hover":{backgroundColor:"#E2E8F0"}},children:(0,oe.jsx)(G.A,{size:14})})})]})]}),(0,oe.jsxs)(r.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))",gap:1.5,mb:2},children:[(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"9px",color:"#6B7280",mb:.25,textTransform:"uppercase",letterSpacing:"0.04em"},children:"Network Operator"}),(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:.5,flexWrap:"wrap"},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"11px",fontWeight:600,color:"#0F172A"},children:kt(e)}),(0,oe.jsx)(a.A,{label:Ct(e.network_technology),size:"small",icon:(0,oe.jsx)(J.A,{size:12}),sx:{height:22,fontSize:"10px",fontWeight:600,color:"#1E3A8A",backgroundColor:"#E0E7FF","& .MuiChip-icon":{color:"#2563EB",ml:.5}}})]})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"9px",color:"#6B7280",mb:.25,textTransform:"uppercase",letterSpacing:"0.04em"},children:"Serial Number"}),(0,oe.jsx)(c.A,{sx:{fontSize:"11px",fontWeight:700,color:"#111827",fontFamily:"inherit",backgroundColor:"#E0E7FF",borderRadius:"6px",padding:"2px 6px",display:"inline-block",wordBreak:"break-all"},children:e.serial||e.id})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"9px",color:"#6B7280",mb:.25,textTransform:"uppercase",letterSpacing:"0.04em"},children:"Connection"}),(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,oe.jsx)(r.A,{sx:{width:8,height:8,backgroundColor:"WiFi"===e.connection_type?"#2563EB":"#16A34A",borderRadius:"50%",boxShadow:"0 0 0 3px rgba(37, 99, 235, 0.1)"}}),(0,oe.jsx)(c.A,{sx:{fontSize:"11px",fontWeight:600,color:"#0F172A"},children:e.connection_type||"USB"})]})]})]}),(0,oe.jsxs)(r.A,{sx:{display:"flex",gap:1},children:[(0,oe.jsx)(g.A,{size:"small",variant:"outlined",onClick:()=>(async e=>{if(we.has(e.id))return be(t=>{const n=new Set(t);return n.delete(e.id),n}),Ze({severity:"info",message:"".concat(e.model||e.id," reconnected.")}),void(n&&Z.D.scanDevices(n).catch(e=>{console.warn("[Dashboard] Failed to rescan devices after reconnect",e)}));if(be(t=>new Set(t).add(e.id)),mt(t=>t.filter(t=>t!==e.id)),n)try{const t=await Z.D.disconnectDevice(e.id,n);Ze({severity:t.success?"success":"error",message:t.message||"Disconnect request ".concat(t.success?"sent":"failed",".")})}catch(t){const e=t instanceof Error?t.message:"Unknown error while disconnecting device.";Ze({severity:"error",message:e})}else Ze({severity:"info",message:"".concat(e.model||e.id," marked as disconnected locally.")})})(e),sx:{fontSize:"10px",height:24,flex:1,borderRadius:"6px",borderColor:i?"#16A34A":"#DC2626",color:i?"#16A34A":"#DC2626","&:hover":{backgroundColor:i?"#16A34A":"#DC2626",color:"#FFFFFF"}},children:i?"Connect":"Disconnect"}),(0,oe.jsx)(g.A,{size:"small",variant:"outlined",onClick:()=>Vt(e),sx:{fontSize:"10px",height:24,flex:1,borderRadius:"6px",borderColor:"#2563EB",color:"#2563EB","&:hover":{backgroundColor:"#2563EB",color:"#FFFFFF"}},children:"Details"})]})]},e.id)}),Lt.length>10&&(0,oe.jsxs)(c.A,{sx:{fontSize:"12px",color:re.colors.subtext,textAlign:"center",mt:2},children:["+",Lt.length-10," more devices"]})]})]})}),(0,oe.jsx)(v.A,{sx:(0,o.A)((0,o.A)({},ce),ae),children:(0,oe.jsxs)(m.A,{sx:{padding:"".concat(re.card.padding,"px ").concat(re.spacing,"px")},children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:re.colors.text},children:"Recent Activity"}),(0,oe.jsxs)(A.A,{direction:"row",spacing:1,children:[(0,oe.jsx)(g.A,{variant:"text",onClick:()=>{0!==Ie.length&&Ue(e=>{const t=!e;return t||Ne(0),t})},disabled:0===Ie.length,sx:{height:30,color:re.colors.subtext,textTransform:"none",fontSize:"12px"},children:Pe?"Show Recent":"View All"}),(0,oe.jsx)(g.A,{variant:"text",onClick:()=>{if(0===Ie.length&&!Le)return;const e=Date.now();Re([]),Ne(0),Ue(!1),Ge(e),(e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{null===e?window.localStorage.removeItem(se):window.localStorage.setItem(se,String(e))}catch(xe){console.warn("[Dashboard] Failed to persist activity clear threshold",xe)}})(e),(0,$.FN)(),Ze({severity:"info",message:"Recent activity cleared."}),ne.track("dashboard_activity_cleared",{scopeId:"default"})},disabled:0===Ie.length&&!Le,sx:{height:30,color:re.colors.subtext,textTransform:"none",fontSize:"12px"},children:"Clean All"})]})]}),(0,oe.jsx)(y.A,{sx:{padding:0},children:Le?(0,oe.jsxs)(S.Ay,{sx:{height:56,borderRadius:"10px",border:"1px solid ".concat(re.colors.border),mb:1,padding:"0 16px",display:"flex",alignItems:"center",gap:2},children:[(0,oe.jsx)(f.A,{size:18}),(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:re.colors.subtext},children:"Loading activity\u2026"})]}):0===Ie.length?(0,oe.jsx)(S.Ay,{sx:{height:56,borderRadius:"10px",border:"1px solid ".concat(re.colors.border),padding:"0 16px",display:"flex",alignItems:"center"},children:(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:re.colors.subtext},children:"No recent executions yet."})}):Et.map(e=>{const t="check"===e.icon?re.colors.success:"warning"===e.icon?re.colors.warning:re.colors.primary,n=e.meta||(e.ts?new Date(e.ts).toLocaleString():"Just now");return(0,oe.jsxs)(S.Ay,{sx:{height:56,borderRadius:"10px",border:"1px solid ".concat(re.colors.border),mb:1,padding:"0 16px","&:last-child":{mb:0}},children:[(0,oe.jsx)(j.A,{sx:{minWidth:40},children:(0,oe.jsx)(r.A,{sx:{color:t},children:tn(e)})}),(0,oe.jsx)(k.A,{primary:(0,oe.jsx)(c.A,{sx:{fontSize:"14px",fontWeight:500,color:re.colors.text},children:e.title}),secondary:(0,oe.jsx)(c.A,{sx:{fontSize:"12px",color:re.colors.subtext},children:n})})]},e.id)})}),Ie.length>4&&(0,oe.jsx)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2},children:Pe?(0,oe.jsxs)(c.A,{sx:{fontSize:"12px",color:"#94A3B8"},children:["Showing all ",Ie.length," activities"]}):(0,oe.jsxs)(oe.Fragment,{children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,oe.jsx)(l.A,{size:"small",onClick:()=>{Ne(e=>Math.max(e-1,0))},disabled:!zt,sx:{border:"1px solid ".concat(re.colors.border)},children:(0,oe.jsx)(q.A,{size:16})}),(0,oe.jsxs)(c.A,{sx:{fontSize:"12px",color:re.colors.subtext},children:["Page ",Oe+1," / ",Ft]}),(0,oe.jsx)(l.A,{size:"small",onClick:()=>{Ne(e=>Math.min(e+1,Ft-1))},disabled:!Dt,sx:{border:"1px solid ".concat(re.colors.border)},children:(0,oe.jsx)(K.A,{size:16})})]}),(0,oe.jsxs)(c.A,{sx:{fontSize:"12px",color:"#94A3B8"},children:["Showing ",Tt," of ",Ie.length]})]})})]})})]})]}),(0,oe.jsxs)(C.A,{open:Je,onClose:()=>qe(!1),maxWidth:"sm",fullWidth:!0,children:[(0,oe.jsx)(F.A,{sx:{fontWeight:600,color:"#0F172A"},children:"Devices Requiring Setup"}),(0,oe.jsx)(E.A,{dividers:!0,children:0===It.length?(0,oe.jsx)(c.A,{sx:{color:"#475569",fontSize:"14px"},children:"All detected devices are ready to use. Connect a new device or refresh to rescan."}):(0,oe.jsxs)(r.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[It.map(e=>(0,oe.jsxs)(p.A,{variant:"outlined",sx:{padding:"12px 16px",borderRadius:"10px",borderColor:"#E2E8F0"},children:[(0,oe.jsxs)(r.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",fontWeight:600,color:"#0F172A"},children:e.model||e.id}),(0,oe.jsx)(c.A,{sx:{fontSize:"12px",color:"#6B7280"},children:Zt(e)})]}),(0,oe.jsx)(a.A,{label:e.raw_adb_status||e.adb_status||e.raw_status||e.status||"unknown",size:"small",sx:{textTransform:"capitalize",backgroundColor:"#F3F4F6",color:"#475569"}})]}),(0,oe.jsxs)(r.A,{sx:{display:"flex",gap:1},children:[(0,oe.jsx)(g.A,{variant:"contained",size:"small",onClick:()=>(async e=>{if(ft){Ye(e.id);try{const t=await Z.D.configureDevice(e.id,n);Ze({severity:t.success?"success":"error",message:t.message||(t.success?"Device configured.":"Configuration failed.")}),await pe()}catch(t){t instanceof Error?Ze({severity:"error",message:t.message}):Ze({severity:"error",message:"Unexpected error while configuring device."})}finally{Ye(null)}}else Ze({severity:"error",message:"Backend is required to configure devices automatically."})})(e),disabled:Ve===e.id,startIcon:Ve===e.id?(0,oe.jsx)(f.A,{size:14,sx:{color:"#FFFFFF"}}):void 0,sx:{textTransform:"none",borderRadius:"8px",backgroundColor:"#2563EB","&:hover":{backgroundColor:"#1E40AF"}},children:Ve===e.id?"Configuring\u2026":"Configure automatically"}),(0,oe.jsx)(g.A,{variant:"outlined",size:"small",onClick:()=>Vt(e),sx:{textTransform:"none",borderRadius:"8px",borderColor:"#1E293B",color:"#1E293B","&:hover":{backgroundColor:"#1E293B",color:"#FFFFFF"}},children:"View details"})]})]},e.id)),(0,oe.jsx)(c.A,{sx:{fontSize:"12px",color:"#64748B"},children:"Tip: Ensure the device is unlocked, developer options are enabled, and USB debugging is allowed."})]})}),(0,oe.jsx)(z.A,{children:(0,oe.jsx)(g.A,{onClick:()=>qe(!1),sx:{textTransform:"none"},children:"Close"})})]}),(0,oe.jsxs)(C.A,{open:Boolean(ct),onClose:sn,maxWidth:"xs",fullWidth:!0,children:[(0,oe.jsx)(F.A,{sx:{fontWeight:600,color:"#0F172A"},children:null!==ct&&void 0!==ct&&ct.value?"Edit alias":"Add alias"}),(0,oe.jsx)(E.A,{dividers:!0,children:(0,oe.jsx)(h.A,{autoFocus:!0,label:"Alias",value:null!==(t=null===ct||void 0===ct?void 0:ct.value)&&void 0!==t?t:"",onChange:e=>cn(e.target.value),placeholder:"e.g. QA Pixel 8",fullWidth:!0,size:"small",helperText:"Visible across dashboard, Device Manager, and workflows."})}),(0,oe.jsxs)(z.A,{children:[(0,oe.jsx)(g.A,{onClick:sn,disabled:lt,sx:{textTransform:"none"},children:"Cancel"}),(0,oe.jsx)(g.A,{onClick:rn,disabled:!ct||lt,variant:"contained",sx:{textTransform:"none"},children:lt?"Saving\u2026":"Save"})]})]}),(0,oe.jsxs)(C.A,{open:Se,onClose:()=>je(!1),maxWidth:"md",fullWidth:!0,children:[(0,oe.jsxs)(F.A,{sx:{fontSize:"20px",fontWeight:600,color:"#0F172A",borderBottom:"1px solid #E5E7EB"},children:["Device Details - ",(null===Ae||void 0===Ae?void 0:Ae.model)||(null===Ae||void 0===Ae?void 0:Ae.id)]}),(0,oe.jsx)(E.A,{sx:{padding:"24px"},children:Ae&&(0,oe.jsxs)(r.A,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:3},children:[(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Device Model"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:Ae.model})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Serial Number"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:700,color:"#0F172A",mb:2},children:Ae.serial||Ae.id})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Android Version"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:(an=Ae,an.android_version||an.os_version||"Unknown")})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Network Operator"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:kt(Ae)})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Network Technology"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:Ct(Ae.network_technology)})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Battery Level"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:(e=>{if(null===e||void 0===e||""===e)return"N/A";if("number"===typeof e)return"".concat(e,"%");const t=String(e);return t.endsWith("%")?t:"".concat(t,"%")})(Ae.battery_level)})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Connection Type"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:Ae.connection_type||"USB"})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Status"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:Ae.status})]}),(0,oe.jsxs)(r.A,{sx:{gridColumn:"span 2"},children:[(0,oe.jsx)(c.A,{sx:{fontSize:"14px",color:"#6B7280",mb:1},children:"Last Seen"}),(0,oe.jsx)(c.A,{sx:{fontSize:"16px",fontWeight:600,color:"#0F172A",mb:2},children:(e=>{if(!e)return"Unknown";const t=String(e).trim();if(!t||"invalid date"===t.toLowerCase())return"Unknown";if("now"===t.toLowerCase())return(new Date).toLocaleString();const n=new Date(t);if(!Number.isNaN(n.getTime()))return n.toLocaleString();const o=Number(t);if(Number.isFinite(o)){const e=new Date(o);if(!Number.isNaN(e.getTime()))return e.toLocaleString()}return"Unknown"})(Ae.last_seen)})]})]})}),(0,oe.jsx)(z.A,{sx:{padding:"16px 24px",borderTop:"1px solid #E5E7EB"},children:(0,oe.jsx)(g.A,{onClick:()=>je(!1),sx:{color:"#6B7280",textTransform:"none",fontWeight:600},children:"Close"})})]}),(0,oe.jsxs)(C.A,{open:Ke,onClose:()=>Qe(!1),maxWidth:"sm",fullWidth:!0,children:[(0,oe.jsx)(F.A,{children:"About MOBIQ v1.0"}),(0,oe.jsx)(E.A,{dividers:!0,children:(0,oe.jsxs)(A.A,{spacing:2,children:[(0,oe.jsx)(c.A,{variant:"body1",children:"MOBIQ v1.0 centralizes the Android automation backend, React dashboard, and Electron shell into a single desktop experience tailored for field teams. It streams live device telemetry, runs scripted modules, and orchestrates repeatable workflows without juggling multiple CLI tools."}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:"Highlights"}),(0,oe.jsxs)(y.A,{dense:!0,sx:{pl:2},children:[(0,oe.jsx)(S.Ay,{sx:{pl:0},children:(0,oe.jsx)(k.A,{primary:"Live device intelligence: operator, radio access, battery, and debug status."})}),(0,oe.jsx)(S.Ay,{sx:{pl:0},children:(0,oe.jsx)(k.A,{primary:"Prebuilt telco modules (airplane mode, call tests, ping, registration checks)."})}),(0,oe.jsx)(S.Ay,{sx:{pl:0},children:(0,oe.jsx)(k.A,{primary:"Workflow composer with local storage, execution history, and retry controls."})}),(0,oe.jsx)(S.Ay,{sx:{pl:0},children:(0,oe.jsx)(k.A,{primary:"Offline-ready installer (Electron + PyInstaller) for Windows field laptops."})})]})]}),(0,oe.jsxs)(r.A,{children:[(0,oe.jsx)(c.A,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:"Build information"}),(0,oe.jsx)(c.A,{variant:"body2",children:"Version 1.0.0 \u2022 Electron 28 \u2022 React 18 \u2022 Python 3.12. Documentation and updates live in the project wiki and release notes. For incidents or feature requests, open an issue in the repository or contact the support channel."})]})]})}),(0,oe.jsx)(z.A,{children:(0,oe.jsx)(g.A,{onClick:()=>Qe(!1),sx:{textTransform:"none"},children:"Close"})})]})]});var an}},6593:(e,t,n)=>{n.d(t,{D:()=>a});var o=n(2555),i=n(9074);const s=()=>{const e=(()=>{const e={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_KEY||{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_KEY,t="undefined"!==typeof window?window.localStorage.getItem("API_KEY"):null;return t&&t.trim()||e&&e.trim()||null})();return e?{"X-API-Key":e}:{}},r=e=>{if("string"!==typeof e)return"disconnected";const t=e.toLowerCase();return["device","online","connected"].includes(t)?"connected":["busy","in_use"].includes(t)?"busy":["disconnected","offline","unauthorized"].includes(t)?"disconnected":t},c=e=>(e=>{if(Array.isArray(e))return e;if(e&&"object"===typeof e){const t=e.devices;if(Array.isArray(t))return t}return[]})(e).map(e=>{const t="string"===typeof(null===e||void 0===e?void 0:e.status)?e.status:void 0,n="string"===typeof(null===e||void 0===e?void 0:e.adb_status)?e.adb_status:void 0,i=r(t),s=r(n),c=null===e||void 0===e?void 0:e.developer_mode_enabled,a=null===e||void 0===e?void 0:e.usb_debugging_enabled,l="boolean"===typeof(null===e||void 0===e?void 0:e.requires_setup)?e.requires_setup:void 0;let d=void 0!==l?l:"connected"!==s||"disconnected"===i||!1===(null===e||void 0===e?void 0:e.developer_mode_enabled)||!1===(null===e||void 0===e?void 0:e.usb_debugging_enabled);return["connected","busy"].includes(i)&&("connected"===s||void 0===n)&&!1!==c&&!1!==a&&(d=!1),(0,o.A)((0,o.A)({},e),{},{status:i,raw_status:t,raw_adb_status:n,requires_setup:d})}),a={async getDevices(e,t){try{const n=(0,i.x)(e),o=new URL("".concat(n,"/api/v1/devices/"));t&&"all"!==t&&o.searchParams.set("scope",t);const r=await fetch(o.toString(),{headers:s()});if(!r.ok)throw new Error("HTTP ".concat(r.status,": ").concat(r.statusText));const a=await r.json();return c(a)}catch(n){console.error("Error fetching devices:",n);try{const t=(0,i.x)(e),n=await fetch("".concat(t,"/api/devices/"),{headers:s()});if(n.ok){const e=await n.json();return c(e)}}catch(o){console.error("Fallback API also failed:",o)}return[]}},async scanDevices(e,t){const n=(0,i.x)(e),o=new URL("".concat(n,"/api/v1/devices/scan"));t&&"all"!==t&&o.searchParams.set("scope",t),await fetch(o.toString(),{method:"POST",headers:s()}).catch(e=>{console.error("Error scanning devices:",e)})},async refreshDevice(e,t){const n=(0,i.x)(e);await fetch("".concat(n,"/api/v1/devices/").concat(t,"/refresh"),{method:"POST",headers:s()}).catch(e=>{console.error("Error refreshing device:",e)})},async captureScreenshot(e,t){try{const n=(0,i.x)(e),o=await fetch("".concat(n,"/api/v1/devices/").concat(t,"/screenshot"),{method:"POST",headers:s()});if(!o.ok)throw new Error("HTTP ".concat(o.status));return await o.json()}catch(n){throw console.error("Error capturing screenshot:",n),n}},async testDevice(e,t){const n=(0,i.x)(t),o=await fetch("".concat(n,"/api/v1/devices/").concat(e,"/test"),{method:"POST",headers:s()});return await o.json()},async rebootDevice(e,t){const n=(0,i.x)(t),o=await fetch("".concat(n,"/api/v1/devices/").concat(e,"/reboot"),{method:"POST",headers:s()});return await o.json()},async disconnectDevice(e,t){const n=(0,i.x)(t),o=await fetch("".concat(n,"/api/v1/devices/").concat(e,"/disconnect"),{method:"POST",headers:s()});return await o.json()},async configureDevice(e,t){const n=(0,i.x)(t),o=await fetch("".concat(n,"/api/v1/devices/").concat(e,"/setup"),{method:"POST",headers:s()});if(!o.ok){const e=await o.text();throw new Error(e||"HTTP ".concat(o.status))}return o.json()},async downloadDeviceReport(e,t){const n=(0,i.x)(t.baseUrl),o=new URL("".concat(n,"/api/v1/devices/").concat(e,"/report"));t.from&&o.searchParams.set("from_ts",t.from),t.to&&o.searchParams.set("to_ts",t.to);const r=await fetch(o.toString(),{headers:s()});if(!r.ok){const e=await r.text();throw new Error(e||"HTTP ".concat(r.status))}const c=await r.blob(),a=(r.headers.get("content-disposition")||"").match(/filename=\"?([^\";]+)\"?/i),l=(null===a||void 0===a?void 0:a[1])||"device-report-".concat(e,".pdf"),d=document.createElement("a"),u=window.URL.createObjectURL(c);return d.href=u,d.download=l,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(u),l}}},8729:(e,t,n)=>{n.d(t,{t:()=>x});var o=n(2555),i=n(5043),s=n(6593);const r="devices-cache",c=e=>{if(!e)return{};try{const t=JSON.parse(e);if(t&&"object"===typeof t)return t}catch(t){console.warn("[deviceCache] Failed to parse cache",t)}return{}},a=e=>{try{window.localStorage.setItem(r,JSON.stringify(e))}catch(t){console.warn("[deviceCache] Failed to persist cache",t)}},l=e=>null!==e&&void 0!==e?e:"__default__";var d=n(9074);const u=new class{constructor(){this.executionSocket=null,this.devicesSocket=null,this.backendUrl="",this.listeners=new Map,this.connectionListeners=new Set,this.pendingDeviceSubscriptions=new Set}toWs(e){return e.replace(/^http/,"ws")}connectExecution(e,t){if(!e)return void console.warn("WebSocketService: backendUrl is empty, skipping execution WS connection");this.backendUrl=e;const n="".concat(this.toWs(e),"/api/v1/ws/executions/").concat(t);this.executionSocket&&this.executionSocket.readyState<=1||(this.executionSocket=new WebSocket(n),this.executionSocket.onopen=()=>{console.log("WS (execution) connected"),this.notifyConnection()},this.executionSocket.onclose=()=>{console.log("WS (execution) disconnected"),this.notifyConnection()},this.executionSocket.onerror=e=>console.error("WS (execution) error:",e),this.executionSocket.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("Invalid WS (execution) message:",e.data)}})}disconnectExecution(){this.executionSocket&&(this.executionSocket.close(),this.executionSocket=null),this.notifyConnection()}connectDevices(e){if(!e)return void console.warn("WebSocketService: backendUrl is empty, skipping device WS connection");this.backendUrl=e;const t="".concat(this.toWs(e),"/api/v1/ws/devices");this.devicesSocket&&this.devicesSocket.readyState<=1||(this.devicesSocket=new WebSocket(t),this.devicesSocket.onopen=()=>{console.log("WS (devices) connected"),this.notifyConnection(),this.pendingDeviceSubscriptions.forEach(e=>{this.sendDeviceSubscription("subscribe_device",e)})},this.devicesSocket.onclose=()=>{console.log("WS (devices) disconnected"),this.notifyConnection()},this.devicesSocket.onerror=e=>console.error("WS (devices) error:",e),this.devicesSocket.onmessage=e=>{try{const t=JSON.parse(e.data);(Array.isArray(t)?t:[t]).forEach(e=>{e&&"object"===typeof e&&"type"in e?this.handleMessage(e):console.warn("WS (devices) ignored message without type:",e)})}catch(t){console.error("Invalid WS (devices) message:",e.data)}})}disconnectDevices(){this.devicesSocket&&(this.devicesSocket.close(),this.devicesSocket=null),this.notifyConnection()}disconnectAll(){this.disconnectExecution(),this.disconnectDevices(),this.listeners.clear()}handleMessage(e){const t=this.listeners.get(e.type);t&&t.forEach(t=>t(e));const n=this.listeners.get("*");n&&n.forEach(t=>t(e))}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{const n=this.listeners.get(e);n&&(n.delete(t),0===n.size&&this.listeners.delete(e))}}subscribeToDeviceUpdates(e){return this.subscribe("device_status",e)}subscribeToExecutionProgress(e){return this.subscribe("execution_progress",e)}subscribeToStepCompletion(e){return this.subscribe("step_completed",e)}subscribeToLogs(e){return this.subscribe("log_entry",e)}subscribeToAll(e){return this.subscribe("*",e)}subscribeToDevice(e){this.pendingDeviceSubscriptions.add(e),this.sendDeviceSubscription("subscribe_device",e)}unsubscribeFromDevice(e){this.pendingDeviceSubscriptions.delete(e),this.sendDeviceSubscription("unsubscribe_device",e)}sendDeviceSubscription(e,t){this.devicesSocket&&this.devicesSocket.readyState===this.devicesSocket.OPEN&&this.devicesSocket.send(JSON.stringify({type:e,device_id:t}))}startLivePreview(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"medium";this.devicesSocket&&this.devicesSocket.readyState===this.devicesSocket.OPEN&&this.devicesSocket.send(JSON.stringify({type:"start_preview",device_id:e,quality:t}))}stopLivePreview(e){this.devicesSocket&&this.devicesSocket.readyState===this.devicesSocket.OPEN&&this.devicesSocket.send(JSON.stringify({type:"stop_preview",device_id:e}))}isConnected(){var e,t,n,o;const i=(null===(e=this.executionSocket)||void 0===e?void 0:e.readyState)===(null===(t=this.executionSocket)||void 0===t?void 0:t.OPEN),s=(null===(n=this.devicesSocket)||void 0===n?void 0:n.readyState)===(null===(o=this.devicesSocket)||void 0===o?void 0:o.OPEN);return Boolean(i||s)}getConnectionState(){return this.isConnected()?"connected":"disconnected"}subscribeConnectionStatus(e){return this.connectionListeners.add(e),()=>{this.connectionListeners.delete(e)}}notifyConnection(){const e=this.getConnectionState();this.connectionListeners.forEach(t=>t(e))}};let h=0;const x=function(){var e,t,n;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{backendUrl:p,scopeId:f,pollMs:g=15e3,autoRefresh:v=!0}=x,m=(0,i.useMemo)(()=>(e=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return null;const t=c(window.localStorage.getItem(r))[l(e)];return t?{devices:Array.isArray(t.devices)?t.devices:[],timestamp:"number"===typeof t.timestamp?t.timestamp:Date.now()}:null})(f),[f]),[w,b]=(0,i.useState)(null!==(e=null===m||void 0===m?void 0:m.devices)&&void 0!==e?e:[]),[A,y]=(0,i.useState)(m?"success":"idle"),[S,j]=(0,i.useState)(null!==(t=null===m||void 0===m?void 0:m.timestamp)&&void 0!==t?t:null),[k,C]=(0,i.useState)(null),F=(0,i.useRef)(null),E=(0,i.useRef)(null!==(n=null===m||void 0===m?void 0:m.devices)&&void 0!==n?n:[]),z=(0,i.useRef)(null),D=(0,i.useCallback)(e=>{b(t=>{const n=e(t);return E.current=n,n})},[]),_=(0,i.useCallback)(async e=>{var t;const n=null!==(t=null===e||void 0===e?void 0:e.showLoader)&&void 0!==t?t:0===E.current.length;try{n&&y("loading");const e=await s.D.getDevices(p,f);D(()=>e),y("success"),C(null),j(Date.now()),((e,t)=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return;const n=c(window.localStorage.getItem(r));n[l(e)]={devices:t,timestamp:Date.now()},a(n)})(f,e)}catch(o){const e=o instanceof Error?o:new Error("Failed to load devices");C(e),0===E.current.length?y("error"):y("success")}},[p,f]),W=(0,i.useCallback)((e,t)=>{e&&D(n=>{let i=!1;const s=n.map(n=>n.id===e?(i=!0,(0,o.A)((0,o.A)({},n),t)):n);return i||s.push((0,o.A)({id:e,model:t.model||"Unknown device"},t)),s})},[D]);(0,i.useEffect)(()=>{if(_({showLoader:0===E.current.length}),v&&!(g<=0))return F.current=setInterval(_,g),()=>{F.current&&clearInterval(F.current)}},[_,v,g]),(0,i.useEffect)(()=>{if(!p)return void(z.current=null);const e=(0,d.x)(p);z.current=e,u.connectDevices(e),h+=1;const t=u.subscribeToDeviceUpdates(e=>{var t;W(e.device_id,{status:e.status,last_seen:null!==(t=e.last_seen)&&void 0!==t?t:e.timestamp})});return()=>{t(),h=Math.max(0,h-1),0===h&&u.disconnectDevices()}},[p,W]);const T=(0,i.useMemo)(()=>w,[w]);return{devices:T,status:A,error:k,refresh:()=>_({showLoader:!0}),isEmpty:0===T.length,lastUpdated:S,applyDevicePatch:W}}},9074:(e,t,n)=>{n.d(t,{x:()=>o});const o=e=>{const t=e&&e.trim().length>0?e:"http://localhost:8007";return t.endsWith("/")?t.slice(0,-1):t}}}]);
//# sourceMappingURL=542.366743e2.chunk.js.map