"use strict";(self.webpackChunktelco_frontend=self.webpackChunktelco_frontend||[]).push([[243],{6593:(e,t,o)=>{o.d(t,{D:()=>a});var n=o(2555),s=o(9074);const i=()=>{const e=(()=>{const e={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_KEY||{NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.API_KEY,t="undefined"!==typeof window?window.localStorage.getItem("API_KEY"):null;return t&&t.trim()||e&&e.trim()||null})();return e?{"X-API-Key":e}:{}},c=e=>{if("string"!==typeof e)return"disconnected";const t=e.toLowerCase();return["device","online","connected"].includes(t)?"connected":["busy","in_use"].includes(t)?"busy":["disconnected","offline","unauthorized"].includes(t)?"disconnected":t},r=e=>(e=>{if(Array.isArray(e))return e;if(e&&"object"===typeof e){const t=e.devices;if(Array.isArray(t))return t}return[]})(e).map(e=>{const t="string"===typeof(null===e||void 0===e?void 0:e.status)?e.status:void 0,o="string"===typeof(null===e||void 0===e?void 0:e.adb_status)?e.adb_status:void 0,s=c(t),i=c(o),r=null===e||void 0===e?void 0:e.developer_mode_enabled,a=null===e||void 0===e?void 0:e.usb_debugging_enabled,d="boolean"===typeof(null===e||void 0===e?void 0:e.requires_setup)?e.requires_setup:void 0;let l=void 0!==d?d:"connected"!==i||"disconnected"===s||!1===(null===e||void 0===e?void 0:e.developer_mode_enabled)||!1===(null===e||void 0===e?void 0:e.usb_debugging_enabled);return["connected","busy"].includes(s)&&("connected"===i||void 0===o)&&!1!==r&&!1!==a&&(l=!1),(0,n.A)((0,n.A)({},e),{},{status:s,raw_status:t,raw_adb_status:o,requires_setup:l})}),a={async getDevices(e,t){try{const o=(0,s.x)(e),n=new URL("".concat(o,"/api/v1/devices/"));t&&"all"!==t&&n.searchParams.set("scope",t);const c=await fetch(n.toString(),{headers:i()});if(!c.ok)throw new Error("HTTP ".concat(c.status,": ").concat(c.statusText));const a=await c.json();return r(a)}catch(o){console.error("Error fetching devices:",o);try{const t=(0,s.x)(e),o=await fetch("".concat(t,"/api/devices/"),{headers:i()});if(o.ok){const e=await o.json();return r(e)}}catch(n){console.error("Fallback API also failed:",n)}return[]}},async scanDevices(e,t){const o=(0,s.x)(e),n=new URL("".concat(o,"/api/v1/devices/scan"));t&&"all"!==t&&n.searchParams.set("scope",t),await fetch(n.toString(),{method:"POST",headers:i()}).catch(e=>{console.error("Error scanning devices:",e)})},async refreshDevice(e,t){const o=(0,s.x)(e);await fetch("".concat(o,"/api/v1/devices/").concat(t,"/refresh"),{method:"POST",headers:i()}).catch(e=>{console.error("Error refreshing device:",e)})},async captureScreenshot(e,t){try{const o=(0,s.x)(e),n=await fetch("".concat(o,"/api/v1/devices/").concat(t,"/screenshot"),{method:"POST",headers:i()});if(!n.ok)throw new Error("HTTP ".concat(n.status));return await n.json()}catch(o){throw console.error("Error capturing screenshot:",o),o}},async testDevice(e,t){const o=(0,s.x)(t),n=await fetch("".concat(o,"/api/v1/devices/").concat(e,"/test"),{method:"POST",headers:i()});return await n.json()},async rebootDevice(e,t){const o=(0,s.x)(t),n=await fetch("".concat(o,"/api/v1/devices/").concat(e,"/reboot"),{method:"POST",headers:i()});return await n.json()},async disconnectDevice(e,t){const o=(0,s.x)(t),n=await fetch("".concat(o,"/api/v1/devices/").concat(e,"/disconnect"),{method:"POST",headers:i()});return await n.json()},async configureDevice(e,t){const o=(0,s.x)(t),n=await fetch("".concat(o,"/api/v1/devices/").concat(e,"/setup"),{method:"POST",headers:i()});if(!n.ok){const e=await n.text();throw new Error(e||"HTTP ".concat(n.status))}return n.json()},async downloadDeviceReport(e,t){const o=(0,s.x)(t.baseUrl),n=new URL("".concat(o,"/api/v1/devices/").concat(e,"/report"));t.from&&n.searchParams.set("from_ts",t.from),t.to&&n.searchParams.set("to_ts",t.to);const c=await fetch(n.toString(),{headers:i()});if(!c.ok){const e=await c.text();throw new Error(e||"HTTP ".concat(c.status))}const r=await c.blob(),a=(c.headers.get("content-disposition")||"").match(/filename=\"?([^\";]+)\"?/i),d=(null===a||void 0===a?void 0:a[1])||"device-report-".concat(e,".pdf"),l=document.createElement("a"),u=window.URL.createObjectURL(r);return l.href=u,l.download=d,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(u),d}}},6655:(e,t,o)=>{o.d(t,{A:()=>x});var n=o(5043),s=o(3216),i=o(6446),c=o(5865),r=o(3845),a=o(7392),d=o(5666),l=o(2143),u=o(4105),h=o(9463),v=o(8326),p=o(7856),b=o(6692),f=o(6963),S=o(73),w=o(579);const x=e=>{let{children:t}=e;const o=(0,s.Zp)(),x=(0,s.zy)(),[g,y]=(0,n.useState)(null),[m,k]=(0,n.useState)(()=>{var e,t;return"undefined"===typeof window?0:null!==(e=null===(t=window.history.state)||void 0===t?void 0:t.idx)&&void 0!==e?e:0}),[A,_]=(0,n.useState)(()=>"undefined"===typeof window?0:window.history.length);(0,n.useEffect)(()=>{var e,t;"undefined"!==typeof window&&(k(null!==(e=null===(t=window.history.state)||void 0===t?void 0:t.idx)&&void 0!==e?e:0),_(window.history.length))},[x]),(0,n.useEffect)(()=>{if("undefined"===typeof window)return;const e=()=>{var e,t;k(null!==(e=null===(t=window.history.state)||void 0===t?void 0:t.idx)&&void 0!==e?e:0),_(window.history.length)};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[]);const E=m>0,F=m<A-1,C=()=>y(null),D=e=>{if(C(),"about"===e)return void window.alert("MOBIQ v1.0\n\nUnified console for mobile automation.\n\u2022 Bundled FastAPI backend + React dashboard + Electron shell\n\u2022 Live device telemetry and diagnostics\n\u2022 One-click telco modules and workflow composer\n\u2022 Offline Windows installer built with PyInstaller\n\nBuild: v1.0.0 (Electron 28 \u2022 React 18 \u2022 Python 3.12)");window.open({faq:"https://github.com/Specpapers/ADB-automation-tool/wiki/FAQ",updates:"https://github.com/Specpapers/ADB-automation-tool/releases",manual:"https://github.com/Specpapers/ADB-automation-tool/wiki/User-Manual"}[e],"_blank","noopener,noreferrer")};return(0,w.jsxs)(i.A,{sx:{display:"flex",minHeight:"100vh",backgroundColor:"#F7F9FC",fontFamily:'Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif'},children:[(0,w.jsxs)(i.A,{sx:{width:280,background:"linear-gradient(180deg, #0D1B2A 0%, #152238 100%)",padding:"16px 12px",display:"flex",flexDirection:"column",position:"sticky",top:0,height:"100vh"},children:[(0,w.jsxs)(i.A,{sx:{mb:4,pb:2,borderBottom:"1px solid rgba(255, 255, 255, 0.08)"},children:[(0,w.jsx)(c.A,{variant:"h6",sx:{color:"rgba(255, 255, 255, 0.9)",fontWeight:700,fontSize:"18px",lineHeight:"26px"},children:"MOBIQ"}),(0,w.jsx)(c.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"12px",lineHeight:"18px"},children:"The Future of Telecom Automation"})]}),(0,w.jsx)(i.A,{sx:{flex:1},children:[{label:"Dashboard",icon:(0,w.jsx)(u.A,{size:20}),path:"/dashboard"},{label:"Test Modules",icon:(0,w.jsx)(b.A,{size:20}),path:"/modules"},{label:"Workflows",icon:(0,w.jsx)(S.A,{size:20}),path:"/workflows"},{label:"Device Manager",icon:(0,w.jsx)(f.A,{size:20}),path:"/devices"}].map((e,t)=>{const n=x.pathname===e.path;return(0,w.jsxs)(i.A,{onClick:()=>o(e.path),sx:{height:48,borderRadius:"12px",padding:"0 14px",display:"flex",alignItems:"center",gap:2,mb:1,cursor:"pointer",backgroundColor:n?"#1E3A8A":"transparent",color:n?"#FFFFFF":"#D1D5DB","&:hover":{backgroundColor:n?"#1E3A8A":"#11253F",color:n?"#FFFFFF":"#E5E7EB"}},children:[(0,w.jsx)(i.A,{sx:{color:n?"#FFFFFF":"#93C5FD"},children:e.icon}),(0,w.jsx)(c.A,{sx:{fontSize:"14px",fontWeight:500},children:e.label})]},t)})}),(0,w.jsxs)(i.A,{sx:{textAlign:"center",mt:2},children:[(0,w.jsxs)(i.A,{sx:{display:"inline-flex",alignItems:"center",gap:1},children:[(0,w.jsx)(r.A,{label:"MOBIQ v1.0",size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.7)",fontSize:"11px"}}),(0,w.jsx)(a.A,{size:"small",onClick:e=>y(e.currentTarget),sx:{color:"rgba(255, 255, 255, 0.8)"},children:(0,w.jsx)(p.A,{size:16})})]}),(0,w.jsxs)(d.A,{anchorEl:g,open:Boolean(g),onClose:C,children:[(0,w.jsx)(l.A,{onClick:()=>D("about"),children:"About"}),(0,w.jsx)(l.A,{onClick:()=>D("faq"),children:"FAQ"}),(0,w.jsx)(l.A,{onClick:()=>D("updates"),children:"Check for updates"}),(0,w.jsx)(l.A,{onClick:()=>D("manual"),children:"User manual"})]})]})]}),(0,w.jsxs)(i.A,{sx:{flex:1,padding:"24px 28px",maxWidth:1320,margin:"0 auto"},children:[(0,w.jsxs)(i.A,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mb:2},children:[(0,w.jsx)(a.A,{size:"small",onClick:()=>o(-1),disabled:!E,sx:{border:"1px solid #E2E8F0",borderRadius:"8px",backgroundColor:E?"#FFFFFF":"#F1F5F9"},"aria-label":"Go back",children:(0,w.jsx)(h.A,{size:18})}),(0,w.jsx)(a.A,{size:"small",onClick:()=>o(1),disabled:!F,sx:{border:"1px solid #E2E8F0",borderRadius:"8px",backgroundColor:F?"#FFFFFF":"#F1F5F9"},"aria-label":"Go forward",children:(0,w.jsx)(v.A,{size:18})})]}),t]})]})}},8729:(e,t,o)=>{o.d(t,{t:()=>v});var n=o(2555),s=o(5043),i=o(6593);const c="devices-cache",r=e=>{if(!e)return{};try{const t=JSON.parse(e);if(t&&"object"===typeof t)return t}catch(t){console.warn("[deviceCache] Failed to parse cache",t)}return{}},a=e=>{try{window.localStorage.setItem(c,JSON.stringify(e))}catch(t){console.warn("[deviceCache] Failed to persist cache",t)}},d=e=>null!==e&&void 0!==e?e:"__default__";var l=o(9074);const u=new class{constructor(){this.executionSocket=null,this.devicesSocket=null,this.backendUrl="",this.listeners=new Map,this.connectionListeners=new Set,this.pendingDeviceSubscriptions=new Set}toWs(e){return e.replace(/^http/,"ws")}connectExecution(e,t){if(!e)return void console.warn("WebSocketService: backendUrl is empty, skipping execution WS connection");this.backendUrl=e;const o="".concat(this.toWs(e),"/api/v1/ws/executions/").concat(t);this.executionSocket&&this.executionSocket.readyState<=1||(this.executionSocket=new WebSocket(o),this.executionSocket.onopen=()=>{console.log("WS (execution) connected"),this.notifyConnection()},this.executionSocket.onclose=()=>{console.log("WS (execution) disconnected"),this.notifyConnection()},this.executionSocket.onerror=e=>console.error("WS (execution) error:",e),this.executionSocket.onmessage=e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.error("Invalid WS (execution) message:",e.data)}})}disconnectExecution(){this.executionSocket&&(this.executionSocket.close(),this.executionSocket=null),this.notifyConnection()}connectDevices(e){if(!e)return void console.warn("WebSocketService: backendUrl is empty, skipping device WS connection");this.backendUrl=e;const t="".concat(this.toWs(e),"/api/v1/ws/devices");this.devicesSocket&&this.devicesSocket.readyState<=1||(this.devicesSocket=new WebSocket(t),this.devicesSocket.onopen=()=>{console.log("WS (devices) connected"),this.notifyConnection(),this.pendingDeviceSubscriptions.forEach(e=>{this.sendDeviceSubscription("subscribe_device",e)})},this.devicesSocket.onclose=()=>{console.log("WS (devices) disconnected"),this.notifyConnection()},this.devicesSocket.onerror=e=>console.error("WS (devices) error:",e),this.devicesSocket.onmessage=e=>{try{const t=JSON.parse(e.data);(Array.isArray(t)?t:[t]).forEach(e=>{e&&"object"===typeof e&&"type"in e?this.handleMessage(e):console.warn("WS (devices) ignored message without type:",e)})}catch(t){console.error("Invalid WS (devices) message:",e.data)}})}disconnectDevices(){this.devicesSocket&&(this.devicesSocket.close(),this.devicesSocket=null),this.notifyConnection()}disconnectAll(){this.disconnectExecution(),this.disconnectDevices(),this.listeners.clear()}handleMessage(e){const t=this.listeners.get(e.type);t&&t.forEach(t=>t(e));const o=this.listeners.get("*");o&&o.forEach(t=>t(e))}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{const o=this.listeners.get(e);o&&(o.delete(t),0===o.size&&this.listeners.delete(e))}}subscribeToDeviceUpdates(e){return this.subscribe("device_status",e)}subscribeToExecutionProgress(e){return this.subscribe("execution_progress",e)}subscribeToStepCompletion(e){return this.subscribe("step_completed",e)}subscribeToLogs(e){return this.subscribe("log_entry",e)}subscribeToAll(e){return this.subscribe("*",e)}subscribeToDevice(e){this.pendingDeviceSubscriptions.add(e),this.sendDeviceSubscription("subscribe_device",e)}unsubscribeFromDevice(e){this.pendingDeviceSubscriptions.delete(e),this.sendDeviceSubscription("unsubscribe_device",e)}sendDeviceSubscription(e,t){this.devicesSocket&&this.devicesSocket.readyState===this.devicesSocket.OPEN&&this.devicesSocket.send(JSON.stringify({type:e,device_id:t}))}startLivePreview(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"medium";this.devicesSocket&&this.devicesSocket.readyState===this.devicesSocket.OPEN&&this.devicesSocket.send(JSON.stringify({type:"start_preview",device_id:e,quality:t}))}stopLivePreview(e){this.devicesSocket&&this.devicesSocket.readyState===this.devicesSocket.OPEN&&this.devicesSocket.send(JSON.stringify({type:"stop_preview",device_id:e}))}isConnected(){var e,t,o,n;const s=(null===(e=this.executionSocket)||void 0===e?void 0:e.readyState)===(null===(t=this.executionSocket)||void 0===t?void 0:t.OPEN),i=(null===(o=this.devicesSocket)||void 0===o?void 0:o.readyState)===(null===(n=this.devicesSocket)||void 0===n?void 0:n.OPEN);return Boolean(s||i)}getConnectionState(){return this.isConnected()?"connected":"disconnected"}subscribeConnectionStatus(e){return this.connectionListeners.add(e),()=>{this.connectionListeners.delete(e)}}notifyConnection(){const e=this.getConnectionState();this.connectionListeners.forEach(t=>t(e))}};let h=0;const v=function(){var e,t,o;let v=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{backendUrl:p,scopeId:b,pollMs:f=15e3,autoRefresh:S=!0}=v,w=(0,s.useMemo)(()=>(e=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return null;const t=r(window.localStorage.getItem(c))[d(e)];return t?{devices:Array.isArray(t.devices)?t.devices:[],timestamp:"number"===typeof t.timestamp?t.timestamp:Date.now()}:null})(b),[b]),[x,g]=(0,s.useState)(null!==(e=null===w||void 0===w?void 0:w.devices)&&void 0!==e?e:[]),[y,m]=(0,s.useState)(w?"success":"idle"),[k,A]=(0,s.useState)(null!==(t=null===w||void 0===w?void 0:w.timestamp)&&void 0!==t?t:null),[_,E]=(0,s.useState)(null),F=(0,s.useRef)(null),C=(0,s.useRef)(null!==(o=null===w||void 0===w?void 0:w.devices)&&void 0!==o?o:[]),D=(0,s.useRef)(null),j=(0,s.useCallback)(e=>{g(t=>{const o=e(t);return C.current=o,o})},[]),T=(0,s.useCallback)(async e=>{var t;const o=null!==(t=null===e||void 0===e?void 0:e.showLoader)&&void 0!==t?t:0===C.current.length;try{o&&m("loading");const e=await i.D.getDevices(p,b);j(()=>e),m("success"),E(null),A(Date.now()),((e,t)=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return;const o=r(window.localStorage.getItem(c));o[d(e)]={devices:t,timestamp:Date.now()},a(o)})(b,e)}catch(n){const e=n instanceof Error?n:new Error("Failed to load devices");E(e),0===C.current.length?m("error"):m("success")}},[p,b]),P=(0,s.useCallback)((e,t)=>{e&&j(o=>{let s=!1;const i=o.map(o=>o.id===e?(s=!0,(0,n.A)((0,n.A)({},o),t)):o);return s||i.push((0,n.A)({id:e,model:t.model||"Unknown device"},t)),i})},[j]);(0,s.useEffect)(()=>{if(T({showLoader:0===C.current.length}),S&&!(f<=0))return F.current=setInterval(T,f),()=>{F.current&&clearInterval(F.current)}},[T,S,f]),(0,s.useEffect)(()=>{if(!p)return void(D.current=null);const e=(0,l.x)(p);D.current=e,u.connectDevices(e),h+=1;const t=u.subscribeToDeviceUpdates(e=>{var t;P(e.device_id,{status:e.status,last_seen:null!==(t=e.last_seen)&&void 0!==t?t:e.timestamp})});return()=>{t(),h=Math.max(0,h-1),0===h&&u.disconnectDevices()}},[p,P]);const O=(0,s.useMemo)(()=>x,[x]);return{devices:O,status:y,error:_,refresh:()=>T({showLoader:!0}),isEmpty:0===O.length,lastUpdated:k,applyDevicePatch:P}}},9074:(e,t,o)=>{o.d(t,{x:()=>n});const n=e=>{const t=e&&e.trim().length>0?e:"http://localhost:8007";return t.endsWith("/")?t.slice(0,-1):t}}}]);
//# sourceMappingURL=243.1c936e35.chunk.js.map