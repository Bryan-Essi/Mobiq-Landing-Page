/*! For license information please see 447.a011189e.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunktelco_frontend=self.webpackChunktelco_frontend||[]).push([[447],{2054:(e,t,n)=>{n.d(t,{A:()=>o});const o=(0,n(7784).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2120:(e,t,n)=>{n.d(t,{HE:()=>l,PS:()=>a,X0:()=>c,wp:()=>s});const o="selectedDeviceIds",r="selectedDeviceId",a="selected-devices:updated",i=e=>{if(!e)return[];if(Array.isArray(e))return e.filter(e=>"string"===typeof e&&e.trim().length>0);if("string"===typeof e)try{const t=JSON.parse(e);if(Array.isArray(t))return i(t)}catch(t){const n=e.trim();if(n.length>0)return[n]}return[]},s=()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return[];try{const e=window.localStorage.getItem(o),t=i(e);if(t.length>0)return Array.from(new Set(t));const n=window.localStorage.getItem(r),a=i(n);if(a.length>0)return l(a),window.localStorage.removeItem(r),a}catch(e){console.warn("[deviceSelection] Failed to read selected devices",e)}return[]},l=e=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{const t=Array.from(new Set(e.filter(e=>"string"===typeof e&&e.trim().length>0)));window.localStorage.setItem(o,JSON.stringify(t)),window.dispatchEvent(new CustomEvent(a,{detail:t}))}catch(t){console.warn("[deviceSelection] Failed to persist selected devices",t)}},c=(e,t)=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),Array.from(n)}},6655:(e,t,n)=>{n.d(t,{A:()=>A});var o=n(5043),r=n(3216),a=n(6446),i=n(5865),s=n(3845),l=n(7392),c=n(5666),d=n(2143),u=n(4105),h=n(9463),f=n(8326),p=n(7856),x=n(6692),m=n(6963),g=n(73),w=n(579);const A=e=>{let{children:t}=e;const n=(0,r.Zp)(),A=(0,r.zy)(),[v,b]=(0,o.useState)(null),[y,k]=(0,o.useState)(()=>{var e,t;return"undefined"===typeof window?0:null!==(e=null===(t=window.history.state)||void 0===t?void 0:t.idx)&&void 0!==e?e:0}),[j,C]=(0,o.useState)(()=>"undefined"===typeof window?0:window.history.length);(0,o.useEffect)(()=>{var e,t;"undefined"!==typeof window&&(k(null!==(e=null===(t=window.history.state)||void 0===t?void 0:t.idx)&&void 0!==e?e:0),C(window.history.length))},[A]),(0,o.useEffect)(()=>{if("undefined"===typeof window)return;const e=()=>{var e,t;k(null!==(e=null===(t=window.history.state)||void 0===t?void 0:t.idx)&&void 0!==e?e:0),C(window.history.length)};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[]);const F=y>0,S=y<j-1,E=()=>b(null),W=e=>{if(E(),"about"===e)return void window.alert("MOBIQ v1.0\n\nUnified console for mobile automation.\n\u2022 Bundled FastAPI backend + React dashboard + Electron shell\n\u2022 Live device telemetry and diagnostics\n\u2022 One-click telco modules and workflow composer\n\u2022 Offline Windows installer built with PyInstaller\n\nBuild: v1.0.0 (Electron 28 \u2022 React 18 \u2022 Python 3.12)");window.open({faq:"https://github.com/Specpapers/ADB-automation-tool/wiki/FAQ",updates:"https://github.com/Specpapers/ADB-automation-tool/releases",manual:"https://github.com/Specpapers/ADB-automation-tool/wiki/User-Manual"}[e],"_blank","noopener,noreferrer")};return(0,w.jsxs)(a.A,{sx:{display:"flex",minHeight:"100vh",backgroundColor:"#F7F9FC",fontFamily:'Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif'},children:[(0,w.jsxs)(a.A,{sx:{width:280,background:"linear-gradient(180deg, #0D1B2A 0%, #152238 100%)",padding:"16px 12px",display:"flex",flexDirection:"column",position:"sticky",top:0,height:"100vh"},children:[(0,w.jsxs)(a.A,{sx:{mb:4,pb:2,borderBottom:"1px solid rgba(255, 255, 255, 0.08)"},children:[(0,w.jsx)(i.A,{variant:"h6",sx:{color:"rgba(255, 255, 255, 0.9)",fontWeight:700,fontSize:"18px",lineHeight:"26px"},children:"MOBIQ"}),(0,w.jsx)(i.A,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",fontSize:"12px",lineHeight:"18px"},children:"The Future of Telecom Automation"})]}),(0,w.jsx)(a.A,{sx:{flex:1},children:[{label:"Dashboard",icon:(0,w.jsx)(u.A,{size:20}),path:"/dashboard"},{label:"Test Modules",icon:(0,w.jsx)(x.A,{size:20}),path:"/modules"},{label:"Workflows",icon:(0,w.jsx)(g.A,{size:20}),path:"/workflows"},{label:"Device Manager",icon:(0,w.jsx)(m.A,{size:20}),path:"/devices"}].map((e,t)=>{const o=A.pathname===e.path;return(0,w.jsxs)(a.A,{onClick:()=>n(e.path),sx:{height:48,borderRadius:"12px",padding:"0 14px",display:"flex",alignItems:"center",gap:2,mb:1,cursor:"pointer",backgroundColor:o?"#1E3A8A":"transparent",color:o?"#FFFFFF":"#D1D5DB","&:hover":{backgroundColor:o?"#1E3A8A":"#11253F",color:o?"#FFFFFF":"#E5E7EB"}},children:[(0,w.jsx)(a.A,{sx:{color:o?"#FFFFFF":"#93C5FD"},children:e.icon}),(0,w.jsx)(i.A,{sx:{fontSize:"14px",fontWeight:500},children:e.label})]},t)})}),(0,w.jsxs)(a.A,{sx:{textAlign:"center",mt:2},children:[(0,w.jsxs)(a.A,{sx:{display:"inline-flex",alignItems:"center",gap:1},children:[(0,w.jsx)(s.A,{label:"MOBIQ v1.0",size:"small",sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.7)",fontSize:"11px"}}),(0,w.jsx)(l.A,{size:"small",onClick:e=>b(e.currentTarget),sx:{color:"rgba(255, 255, 255, 0.8)"},children:(0,w.jsx)(p.A,{size:16})})]}),(0,w.jsxs)(c.A,{anchorEl:v,open:Boolean(v),onClose:E,children:[(0,w.jsx)(d.A,{onClick:()=>W("about"),children:"About"}),(0,w.jsx)(d.A,{onClick:()=>W("faq"),children:"FAQ"}),(0,w.jsx)(d.A,{onClick:()=>W("updates"),children:"Check for updates"}),(0,w.jsx)(d.A,{onClick:()=>W("manual"),children:"User manual"})]})]})]}),(0,w.jsxs)(a.A,{sx:{flex:1,padding:"24px 28px",maxWidth:1320,margin:"0 auto"},children:[(0,w.jsxs)(a.A,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mb:2},children:[(0,w.jsx)(l.A,{size:"small",onClick:()=>n(-1),disabled:!F,sx:{border:"1px solid #E2E8F0",borderRadius:"8px",backgroundColor:F?"#FFFFFF":"#F1F5F9"},"aria-label":"Go back",children:(0,w.jsx)(h.A,{size:18})}),(0,w.jsx)(l.A,{size:"small",onClick:()=>n(1),disabled:!S,sx:{border:"1px solid #E2E8F0",borderRadius:"8px",backgroundColor:S?"#FFFFFF":"#F1F5F9"},"aria-label":"Go forward",children:(0,w.jsx)(f.A,{size:18})})]}),t]})]})}},8447:(e,t,n)=>{n.r(t),n.d(t,{default:()=>fe});var o=n(2555),r=n(5043),a=n(9508),i=n(6446),s=n(5865),l=n(3193),c=n(9285),d=n(2143),u=n(3845),h=n(5146),f=n(1787),p=n(2518),x=n(8903),m=n(2110),g=n(6494),w=n(547),A=n(9216),v=n(7392),b=n(35),y=n(6600),k=n(5316),j=n(9347),C=n(794),F=n(7784);const S=(0,F.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var E=n(9292);const W=(0,F.A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),D=(0,F.A)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),I=(0,F.A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var z=n(2054);const M=(0,F.A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var B=n(4830);const T=(0,F.A)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]]),N=(0,F.A)("circle-stop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]),R=(0,F.A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),P=(0,F.A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),O=(0,F.A)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),_=(0,F.A)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),L=(0,F.A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var U=n(6655),H=n(8738),V=n(7426),q=n(8354),J=n(9849),Q=n(2120),$=n(579);const K="__global__",G="workflowBackendMap",X={countryCode:"+237",phoneNumber:"691234567",duration:30,callCount:1},Z="waiting_time",Y={minutes:60,hours:3600,days:86400},ee={repeatCount:1,durationValue:0,durationUnit:"minutes"},te=e=>{var t,n,o,r;const a=(null!==(t=e.countryCode)&&void 0!==t?t:X.countryCode).replace(/[^0-9]/g,"");return{countryCode:a?"+".concat(a):X.countryCode,phoneNumber:(null!==(n=e.phoneNumber)&&void 0!==n?n:X.phoneNumber).replace(/[^0-9]/g,"")||X.phoneNumber,duration:Math.max(1,Math.min(600,Number(null!==(o=e.duration)&&void 0!==o?o:X.duration))),callCount:Math.max(1,Math.min(10,Number(null!==(r=e.callCount)&&void 0!==r?r:X.callCount)))}},ne=e=>{const t=(()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return{};try{const e=window.localStorage.getItem("callTestParams");if(!e)return{};const t=JSON.parse(e);if(t&&"object"===typeof t){const e={};return Object.entries(t).forEach(t=>{let[n,o]=t;o&&"object"===typeof o&&(e[n]=te(o))}),e}}catch(e){console.warn("[FlowComposer] Failed to read Call Test storage map",e)}return{}})();return e&&t[e]?t[e]:t[K]?t[K]:X},oe=(e,t)=>"call_test"===e.id&&e.callTestParams?te(e.callTestParams):ne(t),re=e=>new Promise(t=>setTimeout(t,e)),ae=e=>(null===e||void 0===e?void 0:e.id)===Z,ie=e=>{var t;const n=oe(e),o=(e=>[e.countryCode.replace(/\s+/g,""),e.phoneNumber.replace(/(\d{2})(?=\d)/g,"$1 ").trim()].filter(Boolean).join(" ").trim())(n),r=Math.max(1,null!==(t=n.callCount)&&void 0!==t?t:1),a=r>1?"".concat(r," appels"):"1 appel";return"Appel vers ".concat(o," \u2022 ").concat(a)},se=e=>"call_test"===e.id?ie(e):ae(e)?(e=>{var t;return"Attente de ".concat(null!==(t=e.waitDurationSeconds)&&void 0!==t?t:5," seconde(s)")})(e):"string"===typeof e.description&&e.description.trim().length>0?e.description.trim():void 0,le=e=>{let{title:t,children:n}=e;return t?(0,$.jsx)(a.A,{title:t,children:n}):n},ce=e=>{const t="number"===typeof e?e:Number(e);if(!Number.isFinite(t))return 5;const n=Math.round(t);return Math.min(600,Math.max(1,n))},de=()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return 5;try{const e=window.localStorage.getItem("waitingTimeDurationSeconds");if(!e)return 5;const t=Number(e);return ce(t)}catch(e){return 5}},ue=e=>{let t=(0,o.A)({},e);if(ae(e)){const n="number"===typeof e.waitDurationSeconds?e.waitDurationSeconds:de();t=(0,o.A)((0,o.A)({},t),{},{waitDurationSeconds:ce(n)})}if("call_test"===e.id&&e.callTestParams)t=(0,o.A)((0,o.A)({},t),{},{callTestParams:(0,o.A)({},e.callTestParams)});else if("call_test"===e.id&&!e.callTestParams){const e=ne();t=(0,o.A)((0,o.A)({},t),{},{callTestParams:(0,o.A)({},e)})}return t},he=e=>{let{open:t,workflow:n,modulesCatalog:a,onClose:u,onSubmit:f,repeatSettings:x}=e;const[m,g]=(0,r.useState)(""),[C,F]=(0,r.useState)(""),[S,E]=(0,r.useState)([]),[W,D]=(0,r.useState)(""),[I,z]=(0,r.useState)(null),[M,B]=(0,r.useState)(String(x.repeatCount)),[T,N]=(0,r.useState)(String(x.durationValue)),[R,P]=(0,r.useState)(x.durationUnit),[U,H]=(0,r.useState)(null);(0,r.useEffect)(()=>{var e,o,r;t&&(g(null!==(e=null===n||void 0===n?void 0:n.name)&&void 0!==e?e:""),F(null!==(o=null===n||void 0===n?void 0:n.description)&&void 0!==o?o:""),E((null!==(r=null===n||void 0===n?void 0:n.modules)&&void 0!==r?r:[]).map(e=>ue(e))),D(""),z(null),B(String(x.repeatCount)),N(String(x.durationValue)),P(x.durationUnit))},[t,n,x]);const V=(0,r.useMemo)(()=>a,[a]),q=(e,t)=>{E(n=>{const o=[...n],r=e+t;if(r<0||r>=o.length)return n;const a=o[e];return o[e]=o[r],o[r]=a,o})},J=(0,r.useCallback)((e,t)=>{E(n=>{if(e===t||e<0||t<0||e>=n.length||t>n.length)return n;const o=[...n],[r]=o.splice(e,1);let a=t;return e<t&&(a=Math.max(0,t-1)),a=Math.min(a,o.length),o.splice(a,0,r),o})},[]),Q=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},K=(e,t)=>{e.preventDefault();const n=e.dataTransfer.getData("text/plain"),o=""!==n?Number(n):U;null===o||Number.isNaN(o)||J(o,t),H(null)},G=()=>{H(null)};return(0,$.jsxs)(b.A,{open:t,onClose:u,fullWidth:!0,maxWidth:"sm",children:[(0,$.jsx)(y.A,{children:n?"Edit Workflow":"New Workflow"}),(0,$.jsx)(k.A,{children:(0,$.jsxs)(A.A,{spacing:2,sx:{mt:1},children:[(0,$.jsx)(h.A,{label:"Workflow name",value:m,onChange:e=>g(e.target.value),fullWidth:!0,autoFocus:!0}),(0,$.jsx)(h.A,{label:"Description",value:C,onChange:e=>F(e.target.value),fullWidth:!0,multiline:!0,minRows:2}),(0,$.jsx)(s.A,{variant:"subtitle2",sx:{color:"#0F172A"},children:"Repeat"}),(0,$.jsx)(h.A,{label:"Repeat count",type:"number",value:M,onChange:e=>{B(e.target.value)},inputProps:{min:1},fullWidth:!0}),(0,$.jsx)(s.A,{variant:"subtitle2",sx:{color:"#0F172A"},children:"Duration"}),(0,$.jsxs)(A.A,{direction:"row",spacing:1,children:[(0,$.jsx)(h.A,{label:"Keep running",type:"number",value:T,onChange:e=>{N(e.target.value)},inputProps:{min:0},sx:{flex:1}}),(0,$.jsx)(l.A,{size:"small",sx:{minWidth:120},children:(0,$.jsxs)(c.A,{value:R,onChange:e=>P(e.target.value),children:[(0,$.jsx)(d.A,{value:"minutes",children:"Minutes"}),(0,$.jsx)(d.A,{value:"hours",children:"Hours"}),(0,$.jsx)(d.A,{value:"days",children:"Days"})]})})]}),(0,$.jsx)(s.A,{variant:"subtitle2",sx:{color:"#0F172A"},children:"Modules"}),(0,$.jsxs)(A.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,$.jsx)(l.A,{fullWidth:!0,size:"small",children:(0,$.jsxs)(c.A,{value:W,onChange:e=>D(e.target.value),displayEmpty:!0,children:[(0,$.jsx)(d.A,{value:"",disabled:!0,children:"Select module"}),V.map(e=>(0,$.jsx)(d.A,{value:e.id,children:e.name},e.id))]})}),(0,$.jsx)(p.A,{variant:"outlined",onClick:()=>{if(!W)return;const e=a.find(e=>e.id===W);if(!e)return;const t=e.id===Z?(0,o.A)((0,o.A)({},e),{},{waitDurationSeconds:de()}):e;E(e=>[...e,ue(t)]),D("")},disabled:!W,sx:{textTransform:"none"},children:"Add"})]}),0===S.length?(0,$.jsx)(s.A,{variant:"body2",sx:{color:"#6B7280"},children:"No modules selected yet."}):(0,$.jsxs)(A.A,{spacing:1,children:[S.map((e,t)=>{var n,r;const a=se(e),l=(0,$.jsxs)(i.A,{draggable:!0,onDragStart:e=>((e,t)=>{e.dataTransfer.setData("text/plain",String(t)),e.dataTransfer.effectAllowed="move",H(t)})(e,t),onDragOver:Q,onDrop:e=>K(e,t),onDragEnd:G,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,backgroundColor:"#F8FAFC",border:"1px ".concat(U===t?"dashed":"solid"," #E5E7EB"),borderRadius:"8px",padding:"8px 12px",cursor:"grab",opacity:U===t?.85:1},children:[(0,$.jsxs)(i.A,{sx:{flex:1},children:[(0,$.jsxs)(s.A,{sx:{fontWeight:500,color:"#0F172A"},children:[t+1,". ",e.name]}),ae(e)?(0,$.jsxs)(s.A,{variant:"caption",sx:{color:"#475569"},children:["Wait ",null!==(n=e.waitDurationSeconds)&&void 0!==n?n:5," second(s)"]}):null]}),(0,$.jsxs)(A.A,{direction:"row",spacing:1,alignItems:"center",children:[ae(e)?(0,$.jsx)(h.A,{size:"small",type:"number",label:"Seconds",value:null!==(r=e.waitDurationSeconds)&&void 0!==r?r:5,onChange:e=>{const n=Number(e.target.value);Number.isFinite(n)&&((e,t)=>{E(n=>{const r=[...n];return r[e]?(r[e]=(0,o.A)((0,o.A)({},r[e]),{},{waitDurationSeconds:ce(t)}),r):n})})(t,n)},inputProps:{min:1,max:600},sx:{width:120}}):null,(0,$.jsx)(v.A,{size:"small",onClick:()=>q(t,-1),disabled:0===t,children:(0,$.jsx)(O,{size:16})}),(0,$.jsx)(v.A,{size:"small",onClick:()=>q(t,1),disabled:t===S.length-1,children:(0,$.jsx)(_,{size:16})}),(0,$.jsx)(v.A,{size:"small",onClick:()=>{return e=t,void E(t=>t.filter((t,n)=>n!==e));var e},children:(0,$.jsx)(L,{size:16})})]})]});return(0,$.jsx)(le,{title:a,children:l},"".concat(e.id,"-").concat(t))}),(0,$.jsx)(i.A,{sx:{border:null===U?"1px dashed transparent":"1px dashed #CBD5F5",borderRadius:"8px",padding:"6px",textAlign:"center",color:"#94A3B8",fontSize:"12px",transition:"border-color 0.2s ease, color 0.2s ease"},onDragOver:Q,onDrop:e=>K(e,S.length),children:null===U?"Drag to reorder modules":"Drop here to move to the end"})]}),I?(0,$.jsx)(w.A,{severity:"error",children:I}):null]})}),(0,$.jsxs)(j.A,{children:[(0,$.jsx)(p.A,{onClick:u,sx:{textTransform:"none"},children:"Cancel"}),(0,$.jsx)(p.A,{variant:"contained",onClick:()=>{if(!m.trim())return void z("Workflow name is required.");if(0===S.length)return void z("Add at least one module.");z(null);const e=C.trim(),t=e.length>0?e:"",o=Number.parseInt(M,10),r=Number.parseInt(T,10),a=Number.isFinite(o)&&o>=1?Math.trunc(o):1,i=Number.isFinite(r)&&r>=0?Math.trunc(r):0;f({name:m.trim(),description:t,modules:S.map(e=>ue(e)),repeatSettings:{repeatCount:a,durationValue:i,durationUnit:R}},null===n||void 0===n?void 0:n.id)},sx:{textTransform:"none"},children:"Save"})]})]})},fe=e=>{var t;let{backendUrl:n}=e;const[F,O]=(0,r.useState)(""),[_,L]=(0,r.useState)("all"),[K,X]=(0,r.useState)(()=>(0,V.WF)()),[te,ne]=(0,r.useState)(!1),[ie,de]=(0,r.useState)(null),[ue,fe]=(0,r.useState)(null),[pe,xe]=(0,r.useState)(()=>(0,Q.wp)()),[me,ge]=(0,r.useState)({}),[we,Ae]=(0,r.useState)({}),[ve,be]=(0,r.useState)({}),[ye,ke]=(0,r.useState)({}),[je,Ce]=(0,r.useState)({}),Fe=(0,r.useRef)({}),[Se,Ee]=(0,r.useState)({}),[We,De]=(0,r.useState)({}),Ie=(0,r.useRef)({}),[ze,Me]=(0,r.useState)([]),[Be,Te]=(0,r.useState)(null),[Ne,Re]=(0,r.useState)(!1),[Pe,Oe]=(0,r.useState)(null),[_e,Le]=(0,r.useState)("10"),[Ue,He]=(0,r.useState)(null),[Ve,qe]=(0,r.useState)([]),[Je,Qe]=(0,r.useState)(()=>(()=>{if("undefined"===typeof window||"undefined"===typeof window.localStorage)return{};try{const e=window.localStorage.getItem(G);if(!e)return{};const t=JSON.parse(e);if(t&&"object"===typeof t){const e={};return Object.entries(t).forEach(t=>{let[n,o]=t;"string"===typeof n&&"string"===typeof o&&(e[n]=o)}),e}}catch(e){console.warn("[FlowComposer] Failed to read backend workflow map",e)}return{}})()),[$e,Ke]=(0,r.useState)([]),Ge=(0,r.useMemo)(()=>new Map(H.v.map(e=>[e.id,e])),[]),Xe=(0,r.useMemo)(()=>n?n.replace(/\/$/,""):"",[n]),Ze=(0,r.useMemo)(()=>{const e=Number(_e);if(!Number.isFinite(e)||e<=0)return null;return new Date(Date.now()+60*e*1e3).toLocaleString([],{hour:"2-digit",minute:"2-digit"})},[_e]),Ye=(0,r.useCallback)(e=>{const t="".concat(e.name," (Copy)");(0,V.ss)({name:t,description:e.description,modules:e.modules,runCount:0,lastRunAt:null}),X((0,V.WF)()),fe({severity:"success",message:'Workflow "'.concat(t,'" created.')})},[]);(0,r.useEffect)(()=>{const e=()=>X((0,V.WF)());return e(),window.addEventListener(V.WK,e),()=>{window.removeEventListener(V.WK,e)}},[]),(0,r.useEffect)(()=>{const e=e=>{const t=e.detail;Array.isArray(t)?xe(t):xe((0,Q.wp)())};return window.addEventListener(Q.PS,e),()=>{window.removeEventListener(Q.PS,e)}},[]),(0,r.useEffect)(()=>{Ne||qe(pe)},[pe,Ne]),(0,r.useEffect)(()=>{Fe.current=je},[je]),(0,r.useEffect)(()=>{if("undefined"!==typeof window&&"undefined"!==typeof window.localStorage)try{window.localStorage.setItem(G,JSON.stringify(Je))}catch(e){console.warn("[FlowComposer] Failed to persist backend workflow map",e)}},[Je]);const et=e=>{var t;return null!==(t=Se[e])&&void 0!==t?t:ee},tt=(0,r.useCallback)((e,t)=>{Ee(n=>{var r;return(0,o.A)((0,o.A)({},n),{},{[e]:(0,o.A)((0,o.A)({},null!==(r=n[e])&&void 0!==r?r:ee),t)})})},[]),nt=(0,r.useCallback)((e,t)=>{Ce(n=>{const r=(0,o.A)({},n);return t?r[e]=!0:delete r[e],r})},[]),ot=(0,r.useCallback)(e=>Boolean(je[e]),[je]),rt=(0,r.useCallback)(e=>{De(t=>(0,o.A)((0,o.A)({},t),{},{[e]:!0}))},[]),at=(0,r.useCallback)(e=>{De(t=>{const n=(0,o.A)({},t);return delete n[e],n}),Ie.current[e]&&delete Ie.current[e]},[]),it=(0,r.useCallback)(e=>!0===We[e],[We]),st=(0,r.useCallback)(e=>{rt(e),nt(e,!1);const t=Ie.current[e];t&&t.abort()},[rt,nt]),lt=(0,r.useMemo)(()=>[...H.v].sort((e,t)=>e.name.localeCompare(t.name)),[]),ct=(0,r.useMemo)(()=>[...K].sort((e,t)=>t.updatedAt.localeCompare(e.updatedAt)),[K]),dt=K.length,ut=K.filter(e=>"active"===e.status),ht=K.filter(e=>"draft"===e.status),ft=K.reduce((e,t)=>e+(t.runCount||0),0),pt=K.reduce((e,t)=>t.lastRunAt&&(!e||t.lastRunAt>e)?t.lastRunAt:e,null),xt=(0,r.useMemo)(()=>{if(!pt)return null;const e=new Date(pt);return Number.isNaN(e.getTime())?null:e.toLocaleString()},[pt]),mt=ct.filter(e=>{const t="all"===_||e.status===_,n=F.trim().toLowerCase(),o=0===n.length||e.name.toLowerCase().includes(n)||(e.description||"").toLowerCase().includes(n);return t&&o}),gt=(0,r.useCallback)(async e=>{if(!Xe)return Me([]),void Te(null);try{const t=await fetch("".concat(Xe,"/api/workflows/schedules"),{signal:e});if(!t.ok){const e=await t.text();throw new Error(e||"Failed to load schedules (HTTP ".concat(t.status,")"))}const n=await t.json();if(!Array.isArray(n))throw new Error("Unexpected schedule payload.");Me(n),Te(null)}catch(t){if(null!==e&&void 0!==e&&e.aborted)return;Te(t instanceof Error?t.message:"Unable to load workflow schedules from the backend.")}},[Xe]);(0,r.useEffect)(()=>{const e=new AbortController;gt(e.signal);const t=window.setInterval(()=>gt(),15e3);return()=>{e.abort(),window.clearInterval(t)}},[gt]);const wt=(0,r.useMemo)(()=>{const e={},t=Object.entries(Je).reduce((e,t)=>{let[n,o]=t;return e[o]=n,e},{});return ze.forEach(n=>{var o;if("scheduled"!==n.status)return;const r=t[n.workflow_id];if(!r)return;const a=null!==(o=e[r])&&void 0!==o?o:{deviceIds:[],scheduleIds:[],nextRunAt:n.run_at};a.deviceIds.push(n.device_id),a.scheduleIds.push(n.id),(!a.nextRunAt||new Date(n.run_at).getTime()<new Date(a.nextRunAt).getTime())&&(a.nextRunAt=n.run_at),e[r]=a}),e},[ze,Je]),At=(0,r.useCallback)(async e=>{if(!Xe)throw new Error("Backend unavailable: no URL configured.");const t=Je[e.id];if(t)try{const n=await fetch("".concat(Xe,"/api/workflows/").concat(t));if(n.ok)return t;if(404!==n.status){const t=await n.text();throw new Error(t||'Failed to validate workflow "'.concat(e.name,'" on backend (HTTP ').concat(n.status,")"))}Qe(t=>{const n=(0,o.A)({},t);return delete n[e.id],n})}catch(a){if(a instanceof Error)throw a;throw new Error("Unable to validate workflow on backend.")}const n=await fetch("".concat(Xe,"/api/workflows"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,description:e.description,modules:e.modules.map(e=>e.id)})});if(!n.ok){const e=await n.text();throw new Error(e||"Failed to register workflow on backend (HTTP ".concat(n.status,")"))}const r=await n.json();if(null===r||void 0===r||!r.id)throw new Error("Backend did not return a workflow identifier.");return Qe(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:r.id})),r.id},[Xe,Je]);(0,r.useEffect)(()=>{if(!Xe)return void Ke([]);const e=new AbortController;return(async()=>{try{const t=await fetch("".concat(Xe,"/api/workflows"),{signal:e.signal});if(!t.ok){const e=await t.text();throw new Error(e||"Failed to read backend workflows (HTTP ".concat(t.status,")"))}const n=await t.json();if(!Array.isArray(n))throw new Error("Unexpected backend workflow payload.");const r=n.map(e=>e&&"object"===typeof e?e.id:null).filter(e=>"string"===typeof e);Ke(r),Qe(e=>{const t=new Set(r);let n=!1;const a=(0,o.A)({},e);return Object.entries(e).forEach(e=>{let[o,r]=e;t.has(r)||(delete a[o],n=!0)}),n?a:e})}catch(t){e.signal.aborted||console.warn("[FlowComposer] Failed to sync backend workflows",t)}})(),()=>e.abort()},[Xe]),(0,r.useEffect)(()=>{if(!Xe)return;const e=new Set($e),t=K.filter(t=>{const n=Je[t.id];return!n||!e.has(n)});if(0===t.length)return;let n=!1;return(async()=>{for(const o of t){if(n)break;try{await At(o)}catch(e){console.warn("[FlowComposer] Failed to register workflow on backend",e);break}}})(),()=>{n=!0}},[At,Xe,$e,Je,K]);const vt=(0,r.useCallback)(e=>{const t=pe.length>0?pe:(0,Q.wp)();0!==t.length?(Oe(e),qe(t),Le("10"),He(null),Re(!0)):fe({severity:"error",message:"Select one or more devices on the dashboard before scheduling a workflow."})},[pe]),bt=(0,r.useCallback)(()=>{Re(!1),Oe(null),He(null)},[]),yt=(0,r.useCallback)(async()=>{if(!Pe)return;if(!Xe)return void He("Backend unavailable: no URL configured.");const e=Number(_e);if(!Number.isFinite(e)||e<=0)return void He("Delay must be at least 1 minute.");if(0===Ve.length)return void He("Select one or more devices on the dashboard before scheduling.");const t=new Date(Date.now()+60*e*1e3).toISOString();try{const e=async e=>{const n=await fetch("".concat(Xe,"/api/workflows/").concat(e,"/schedule"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_ids:Ve,run_at:t})});if(!n.ok){const e=await n.text()||"Scheduling failed (HTTP ".concat(n.status,")");if(404===n.status&&e.toLowerCase().includes("workflow not found"))return{retry:!0,message:e};throw new Error(e)}return{retry:!1}};let n=await At(Pe),r=await e(n);r.retry&&(Qe(e=>{const t=(0,o.A)({},e);return delete t[Pe.id],t}),n=await At(Pe),r=await e(n)),r.retry||(fe({severity:"success",message:'Workflow "'.concat(Pe.name,'" scheduled for ').concat(new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),".")}),Re(!1),Oe(null),He(null),await gt())}catch(n){He(n instanceof Error?n.message:"Unable to schedule workflow.")}},[At,gt,Xe,_e,Ve,Pe]),kt=(0,r.useCallback)(async e=>{const t=wt[e];if(t&&0!==t.scheduleIds.length)if(Xe)try{await Promise.all(t.scheduleIds.map(e=>fetch("".concat(Xe,"/api/workflows/schedules/").concat(e),{method:"DELETE"}))),fe({severity:"info",message:"Scheduled workflow run cancelled."}),await gt()}catch(n){fe({severity:"error",message:n instanceof Error?n.message:"Unable to cancel scheduled workflow."})}else fe({severity:"error",message:"Backend unavailable: no URL configured."})},[gt,Xe,wt]),jt=(0,r.useCallback)(e=>{const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString([],{hour:"2-digit",minute:"2-digit"})},[]),Ct=()=>{ne(!1),de(null)},Ft=(0,r.useCallback)(async(e,t,n,o,r,a,i,s)=>{if(ae(t)){const e=ce(t.waitDurationSeconds);return e>0&&await re(1e3*e),{successes:n,failures:[]}}const l="call_test"===(c=t.id)?"voice_call_test":c===Z?null:c;var c;if(!l)return{successes:[],failures:n.map(e=>({deviceId:e,reason:'Module "'.concat(t.name,'" not supported for workflows.')}))};const d=await Promise.allSettled(n.map(async n=>{var c;if(null!==s&&void 0!==s&&s.aborted)throw{deviceId:n,message:"Execution cancelled"};const d=null!==(c=((e,t)=>{if("call_test"===e.id){const n=oe(e,t);return{number:"".concat(n.countryCode).concat(n.phoneNumber).replace(/\s+/g,""),duration:n.duration,call_count:n.callCount,calls:n.callCount}}})(t,n))&&void 0!==c?c:{};try{const c=await fetch("".concat(o,"/api/modules/").concat(l,"/execute"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({device_id:n,parameters:d,workflow_id:e.id,workflow_name:e.name,module_id:t.id,repeat_count:r,duration_seconds:a,run_iteration:i}),signal:s});if(!c.ok){throw{deviceId:n,message:await c.text()||"Backend failure (HTTP ".concat(c.status,")")}}const u=await c.json(),h="string"===typeof u.status?u.status.toLowerCase():"completed";if(!("boolean"===typeof u.success?u.success:"failed"!==h&&"error"!==h)){throw{deviceId:n,message:u.error||u.message||'Module "'.concat(t.name,'" failed')}}return{deviceId:n,data:u}}catch(u){if("AbortError"===(null===u||void 0===u?void 0:u.name))throw{deviceId:n,message:"Execution cancelled"};throw u}})),u=[],h=[];return d.forEach(e=>{if("fulfilled"===e.status)u.push(e.value.deviceId);else{const n=e.reason&&e.reason.deviceId||"unknown",o=e.reason&&e.reason.message||(e.reason instanceof Error?e.reason.message:'Module "'.concat(t.name,'" execution failed.'));h.push({deviceId:n,reason:o})}}),{successes:u,failures:h}},[]),St=async e=>{var t,r;if(!n)return void fe({severity:"error",message:"Backend unavailable: no URL configured."});const a=pe.length>0?pe:(0,Q.wp)();if(0===a.length)return void fe({severity:"error",message:"Select one or more devices on the dashboard before running a workflow."});const i=e.modules.map(e=>e.name).filter(Boolean).join(" \u2192 ")||e.name,s=et(e.id),l=Number.isFinite(s.repeatCount)?Math.max(1,Math.trunc(s.repeatCount)):1,c=null!==(t=s.durationUnit)&&void 0!==t?t:"minutes",d=(u=null!==(r=s.durationValue)&&void 0!==r?r:0,h=c,(Number.isFinite(u)?Math.max(0,Math.trunc(u)):0)*Y[h]);var u,h;Ie.current[e.id]&&(Ie.current[e.id].abort(),delete Ie.current[e.id]);const f=new AbortController;Ie.current[e.id]=f,De(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:!1})),ge(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:!0})),be(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:e.modules.length>0?0:null})),ke(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:[]})),Ae(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:"Planning workflow (".concat(i,") for ").concat(a.length," device").concat(1===a.length?"":"s","\u2026")})),fe({severity:"info",message:'Workflow "'.concat(e.name,'" started (').concat(i,").")});const p=Date.now(),x=1e3*d;let m=0,g=0,w=!1;const A=async()=>{if(Fe.current[e.id]){for(Ae(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:'Workflow "'.concat(e.name,'" paused. Click resume to continue.')}));Fe.current[e.id];)await re(500);Ae(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:'Resuming workflow "'.concat(e.name,'"\u2026')}))}};try{for(;;){if(await A(),it(e.id)){w=!0;break}m+=1;const t="Run #".concat(m);ke(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:[]})),be(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:e.modules.length>0?0:null})),Ae(n=>(0,o.A)((0,o.A)({},n),{},{[e.id]:"Starting ".concat(t," (").concat(i,") on ").concat(a.length," device").concat(1===a.length?"":"s","\u2026")}));const n={};a.forEach(e=>{n[e]={success:!0,reasons:[]}});for(let i=0;i<e.modules.length;i+=1){await A();const r=e.modules[i];if(it(e.id)){w=!0;break}be(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:i})),Ae(n=>(0,o.A)((0,o.A)({},n),{},{[e.id]:"".concat(t,': running "').concat(r.name,'" on ').concat(a.length," device").concat(1===a.length?"":"s","\u2026")}));const{failures:s}=await Ft(e,r,a,Xe,l,d,m,f.signal);s.forEach(e=>{let{deviceId:t,reason:o}=e;n[t]?(n[t].success=!1,n[t].reasons.push("".concat(r.name,": ").concat(o))):n[t]={success:!1,reasons:[o]}}),ke(t=>{const n=t[e.id]||[];return n.includes(i)?t:(0,o.A)((0,o.A)({},t),{},{[e.id]:[...n,i]})});const c=e.modules[i+1];i<e.modules.length-1&&!ae(r)&&!ae(c)&&await re(2e3)}if(w)break;const r=a.filter(e=>{var t;return!1!==(null===(t=n[e])||void 0===t?void 0:t.success)}),s=a.filter(e=>{var t;return!1===(null===(t=n[e])||void 0===t?void 0:t.success)}).map(e=>({deviceId:e,reason:n[e].reasons.join(" | ")||"Execution failed."})),c=(new Date).toISOString();if(r.length>0?((0,V.k0)(e.id,c),r.forEach(t=>(0,q.u6)(t,e.id,e.name,c))):(0,V.Ob)(e.id,{lastRunAt:c}),r.forEach(t=>(0,J.$Q)({deviceId:t,type:"workflow",label:e.name,status:"success",referenceId:e.id,timestamp:c})),s.forEach(t=>{let{deviceId:n,reason:o}=t;return(0,J.$Q)({deviceId:n,type:"workflow",label:e.name,status:"failure",referenceId:e.id,details:o,timestamp:c})}),X((0,V.WF)()),0===s.length)fe({severity:"success",message:"".concat(t,' of "').concat(e.name,'" completed on ').concat(r.length," device").concat(1===r.length?"":"s",".")});else if(r.length>0){const n=s.map(e=>"".concat(e.deviceId)).join(", ");fe({severity:"warning",message:"".concat(t,' of "').concat(e.name,'" completed with warnings. Failed for: ').concat(n,".")})}else{const n=s.map(e=>"".concat(e.deviceId,": ").concat(e.reason)).join(" | ");fe({severity:"error",message:"".concat(t,' of "').concat(e.name,'" failed on all devices. ').concat(n)})}Ae(n=>(0,o.A)((0,o.A)({},n),{},{[e.id]:0===s.length?"".concat(t," completed successfully."):r.length>0?"".concat(t," completed with warnings."):"".concat(t," failed.")})),g=m;const u=Date.now()-p;if(!(m<l)&&!(d>0&&u<x))break;Ae(n=>(0,o.A)((0,o.A)({},n),{},{[e.id]:"".concat(t," completed. Preparing next run\u2026")})),await re(1200)}Ae(w?t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:'Workflow "'.concat(e.name,'" cancelled after ').concat(g," completed run").concat(1===g?"":"s",".")}):t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:'Workflow "'.concat(e.name,'" completed after ').concat(g," run").concat(1===g?"":"s",".")})),await re(1200)}catch(v){if(w=w||it(e.id),w)fe({severity:"info",message:'Workflow "'.concat(e.name,'" cancelled after ').concat(g," completed run").concat(1===g?"":"s",".")}),Ae(t=>(0,o.A)((0,o.A)({},t),{},{[e.id]:'Workflow "'.concat(e.name,'" cancelled after ').concat(g," completed run").concat(1===g?"":"s",".")}));else{const t=v instanceof Error?v.message:"Unknown error while communicating with the backend.";fe({severity:"error",message:'Failed to run workflow "'.concat(e.name,'": ').concat(t)}),Ae(n=>(0,o.A)((0,o.A)({},n),{},{[e.id]:'Workflow "'.concat(e.name,'" failed').concat(m>0?" during run #".concat(m):"",": ").concat(t)}))}await re(1200)}finally{at(e.id),Ce(t=>{const n=(0,o.A)({},t);return delete n[e.id],n}),ge(t=>{const n=(0,o.A)({},t);return delete n[e.id],n}),be(t=>{const n=(0,o.A)({},t);return delete n[e.id],n}),ke(t=>{const n=(0,o.A)({},t);return delete n[e.id],n}),Ae(t=>{const n=(0,o.A)({},t);return delete n[e.id],n})}},Et=e=>{if(!e)return"Never";const t=new Date(e);return Number.isNaN(t.getTime())?"Never":t.toLocaleString()};return(0,$.jsxs)(U.A,{children:[(0,$.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[(0,$.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,$.jsx)(s.A,{variant:"h1",sx:{fontSize:"28px",lineHeight:"36px",fontWeight:700,color:"#0F172A",mr:2},children:"Workflows"}),(0,$.jsx)(l.A,{size:"small",children:(0,$.jsxs)(c.A,{value:_,onChange:e=>L(e.target.value),sx:{height:36,borderRadius:"10px","& .MuiOutlinedInput-notchedOutline":{borderColor:"#E5E7EB"}},IconComponent:S,children:[(0,$.jsxs)(d.A,{value:"all",children:["All Workflows (",dt,")"]}),(0,$.jsxs)(d.A,{value:"active",children:["Active (",ut.length,")"]}),(0,$.jsxs)(d.A,{value:"draft",children:["Draft (",ht.length,")"]})]})}),(0,$.jsx)(u.A,{label:"".concat(pe.length," device").concat(1===pe.length?"":"s"," selected"),size:"small",sx:{backgroundColor:"#EEF2FF",color:"#2563EB",fontWeight:600}})]}),(0,$.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,$.jsx)(h.A,{placeholder:"Search workflows...",value:F,onChange:e=>O(e.target.value),sx:{width:300,"& .MuiOutlinedInput-root":{height:40,borderRadius:"10px","& fieldset":{borderColor:"#E5E7EB"}}},InputProps:{startAdornment:(0,$.jsx)(f.A,{position:"start",children:(0,$.jsx)(E.A,{size:20,color:"#6B7280"})})}}),(0,$.jsx)(p.A,{variant:"contained",startIcon:(0,$.jsx)(W,{size:20}),onClick:()=>{de(null),ne(!0)},sx:{height:40,borderRadius:"10px",backgroundColor:"#2563EB",textTransform:"none",fontWeight:600,"&:hover":{backgroundColor:"#1E48C7"}},children:"New Workflow"})]})]}),(0,$.jsxs)(x.Ay,{container:!0,spacing:3,sx:{mb:4},children:[(0,$.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,$.jsx)(m.A,{sx:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"16px",boxShadow:"0 1px 2px rgba(16, 24, 40, 0.06)"},children:(0,$.jsxs)(g.A,{sx:{padding:"20px 24px"},children:[(0,$.jsx)(s.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:"#0F172A",mb:2},children:"Total Workflows"}),(0,$.jsx)(s.A,{sx:{fontSize:"48px",fontWeight:700,color:"#0F172A",lineHeight:1},children:dt}),(0,$.jsxs)(s.A,{sx:{fontSize:"12px",lineHeight:"18px",fontWeight:500,color:"#6B7280",mt:1},children:[ut.length," active, ",ht.length," draft"]})]})})}),(0,$.jsx)(x.Ay,{item:!0,xs:12,sm:6,children:(0,$.jsx)(m.A,{sx:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"16px",boxShadow:"0 1px 2px rgba(16, 24, 40, 0.06)"},children:(0,$.jsxs)(g.A,{sx:{padding:"20px 24px"},children:[(0,$.jsx)(s.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:"#0F172A",mb:2},children:"Total Executions"}),(0,$.jsx)(s.A,{sx:{fontSize:"48px",fontWeight:700,color:"#0F172A",lineHeight:1},children:ft}),(0,$.jsx)(s.A,{sx:{fontSize:"12px",lineHeight:"18px",fontWeight:500,color:"#6B7280",mt:1},children:xt?"Last run ".concat(xt):"No runs recorded yet"})]})})})]}),(0,$.jsx)(m.A,{sx:{backgroundColor:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:"16px",boxShadow:"0 1px 2px rgba(16, 24, 40, 0.06)"},children:(0,$.jsxs)(g.A,{sx:{padding:"20px 24px"},children:[(0,$.jsx)(s.A,{sx:{fontSize:"16px",lineHeight:"24px",fontWeight:600,color:"#0F172A",mb:3},children:"Workflows"}),Be&&(0,$.jsx)(w.A,{severity:"warning",sx:{mb:2},children:Be}),(0,$.jsx)(x.Ay,{container:!0,spacing:3,children:mt.map(e=>{const t="active"===e.status?{bg:"#EEF2FF",color:"#2563EB"}:{bg:"#F1F5F9",color:"#64748B"};const n=e.modules.length,o="".concat(Math.max(1,2*n),"-").concat(Math.max(1,3*n),"m"),r=e.description&&e.description.trim().length>0?e.description:"No description provided.",l=e.modules.slice(0,4).map((e,t)=>{const n=Ge.get(e.id),o=(null===n||void 0===n?void 0:n.name)||e.name||e.id,r=e.callTestParams?Object.keys(e.callTestParams).length:0,a=r>0?" \xb7 ".concat(r," param").concat(r>1?"s":""):"";return"".concat(t+1,". ").concat(o).concat(a)}),c=(e.modules.length,l.length,Boolean(me[e.id])),d=we[e.id],h=ve[e.id],f=ye[e.id]||[];et(e.id);return(0,$.jsx)(x.Ay,{item:!0,xs:12,children:(0,$.jsx)(m.A,{sx:{backgroundColor:"#F8FAFC",border:"1px solid #E5E7EB",borderRadius:"12px",transition:"all 0.2s","&:hover":{boxShadow:"0 4px 8px rgba(16, 24, 40, 0.12)",borderColor:"#2563EB"}},children:(0,$.jsx)(g.A,{sx:{padding:"16px 20px"},children:(0,$.jsxs)(i.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",children:[(0,$.jsxs)(i.A,{flex:1,children:[(0,$.jsxs)(i.A,{display:"flex",alignItems:"center",gap:2,mb:1,children:[(0,$.jsx)(s.A,{variant:"h6",sx:{fontSize:"16px",fontWeight:600,color:"#0F172A"},children:e.name}),(0,$.jsx)(u.A,{label:e.status,size:"small",sx:{backgroundColor:t.bg,color:t.color,fontWeight:600,fontSize:"11px",textTransform:"capitalize"}})]}),(0,$.jsx)(s.A,{variant:"body2",sx:{color:"#6B7280",mb:2,fontSize:"14px"},children:r}),wt[e.id]&&(0,$.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",gap:1.5,backgroundColor:"#E0F2FE",borderRadius:"10px",padding:"8px 12px",mb:2},children:[(0,$.jsxs)(s.A,{sx:{fontSize:"13px",color:"#0369A1",flex:1},children:["Scheduled for ",jt(wt[e.id].nextRunAt)," \u2022"," ",wt[e.id].deviceIds.length," device",1===wt[e.id].deviceIds.length?"":"s"]}),(0,$.jsx)(p.A,{size:"small",variant:"text",color:"warning",onClick:()=>kt(e.id),sx:{textTransform:"none"},children:"Cancel"})]}),(0,$.jsx)(A.A,{direction:"row",spacing:1,sx:{flexWrap:"wrap",mb:2},children:e.modules.map((t,n)=>{const o=h===n,r=f.includes(n),a=o?"#2563EB":r?"#D1FAE5":"#E0E7FF",i=o?"#FFFFFF":r?"#065F46":"#1E3A8A",s="".concat(n+1,". ").concat(t.name),l="".concat(e.id,"-").concat(t.id,"-").concat(n),c=se(t),d=(0,$.jsx)(u.A,{label:s,size:"small",sx:{backgroundColor:a,color:i,mb:1,fontWeight:o?700:500}});return(0,$.jsx)(le,{title:c,children:d},l)})}),(0,$.jsxs)(i.A,{display:"flex",gap:4,children:[(0,$.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(D,{size:16,color:"#6B7280"}),(0,$.jsxs)(s.A,{variant:"caption",sx:{color:"#6B7280",fontSize:"12px"},children:[n," module",1===n?"":"s"]})]}),(0,$.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(I,{size:16,color:"#6B7280"}),(0,$.jsx)(s.A,{variant:"caption",sx:{color:"#6B7280",fontSize:"12px"},children:o})]}),(0,$.jsxs)(i.A,{display:"flex",alignItems:"center",gap:1,children:[(0,$.jsx)(z.A,{size:16,color:e.runCount>0?"#16A34A":"#94A3B8"}),(0,$.jsxs)(s.A,{variant:"caption",sx:{color:"#6B7280",fontSize:"12px"},children:[e.runCount," run",1===e.runCount?"":"s"]})]}),(0,$.jsxs)(s.A,{variant:"caption",sx:{color:"#6B7280",fontSize:"12px"},children:["Last run: ",Et(e.lastRunAt)]})]}),d&&(0,$.jsx)(s.A,{variant:"caption",sx:{color:"#2563EB",display:"block",mt:1},children:d})]}),(0,$.jsx)(i.A,{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1.5,children:(0,$.jsxs)(i.A,{display:"flex",gap:1,children:[(0,$.jsx)(a.A,{title:"Clone Workflow",children:(0,$.jsx)(v.A,{onClick:()=>Ye(e),sx:{backgroundColor:"#E2E8F0",color:"#0F172A",width:36,height:36,"&:hover":{backgroundColor:"#CBD5E1"}},children:(0,$.jsx)(M,{size:16})})}),(0,$.jsx)(a.A,{title:"Schedule Workflow",children:(0,$.jsx)(v.A,{onClick:()=>vt(e),sx:{backgroundColor:"#E0E7FF",color:"#1E3A8A",width:36,height:36,"&:hover":{backgroundColor:"#C7D2FE"}},children:(0,$.jsx)(I,{size:16})})}),(0,$.jsx)(a.A,{title:c?ot(e.id)?"Resume Workflow":"Pause Workflow":"Run Workflow",children:(0,$.jsx)(v.A,{onClick:()=>{var t;c?ot(e.id)?(t=e.id,nt(t,!1)):(e=>{nt(e,!0)})(e.id):St(e)},sx:{backgroundColor:c?ot(e.id)?"#DCFCE7":"#FEF3C7":"#2563EB",color:c?ot(e.id)?"#15803D":"#B45309":"#FFFFFF",width:36,height:36,"&:hover":{backgroundColor:c?ot(e.id)?"#BBF7D0":"#FDE68A":"#1E48C7"}},children:c?ot(e.id)?(0,$.jsx)(B.A,{size:16}):(0,$.jsx)(T,{size:16}):(0,$.jsx)(B.A,{size:16})})}),c&&(0,$.jsx)(a.A,{title:"Cancel Workflow",children:(0,$.jsx)(v.A,{onClick:()=>st(e.id),"aria-label":"Cancel workflow",sx:{backgroundColor:"#FEE2E2",color:"#B91C1C",width:36,height:36,"&:hover":{backgroundColor:"#FECACA"}},children:(0,$.jsx)(N,{size:16})})}),(0,$.jsx)(a.A,{title:"Edit Workflow",children:(0,$.jsx)(v.A,{onClick:()=>{de(e),ne(!0)},sx:{backgroundColor:"#F1F5F9",color:"#475569",width:36,height:36,"&:hover":{backgroundColor:"#E2E8F0"}},children:(0,$.jsx)(R,{size:16})})}),(0,$.jsx)(a.A,{title:"Delete Workflow",children:(0,$.jsx)(v.A,{onClick:()=>(e=>{if(me[e.id])return void fe({severity:"warning",message:'Stop workflow "'.concat(e.name,'" before deleting it.')});window.confirm('Delete workflow "'.concat(e.name,'"?'))&&((0,V.kj)(e.id),X((0,V.WF)()),fe({severity:"success",message:'Workflow "'.concat(e.name,'" deleted.')}))})(e),disabled:c,sx:{backgroundColor:"#FEF2F2",color:"#DC2626",width:36,height:36,"&:hover":{backgroundColor:"#FEE2E2"}},children:(0,$.jsx)(P,{size:16})})})]})})]})})})},e.id)})})]})}),(0,$.jsxs)(b.A,{open:Ne,onClose:bt,fullWidth:!0,maxWidth:"xs",children:[(0,$.jsx)(y.A,{children:"Schedule Workflow"}),(0,$.jsx)(k.A,{dividers:!0,children:(0,$.jsxs)(A.A,{spacing:2,sx:{mt:1},children:[(0,$.jsx)(s.A,{sx:{color:"#0F172A",fontWeight:600},children:null!==(t=null===Pe||void 0===Pe?void 0:Pe.name)&&void 0!==t?t:"Select a workflow"}),(0,$.jsx)(h.A,{label:"Delay before run (minutes)",type:"number",value:_e,onChange:e=>{Le(e.target.value),He(null)},inputProps:{min:1}}),Ze&&(0,$.jsxs)(s.A,{variant:"caption",sx:{color:"#475569"},children:["Will run around ",Ze,"."]}),(0,$.jsxs)(s.A,{variant:"body2",sx:{color:"#475569"},children:["Devices targeted: ",Ve.length]}),Ue&&(0,$.jsx)(w.A,{severity:"error",children:Ue})]})}),(0,$.jsxs)(j.A,{children:[(0,$.jsx)(p.A,{onClick:bt,children:"Close"}),(0,$.jsx)(p.A,{variant:"contained",onClick:yt,children:"Schedule"})]})]}),(0,$.jsx)(he,{open:te,workflow:ie,modulesCatalog:lt,onClose:Ct,onSubmit:(e,t)=>{var n,r;if(!e.name.trim())return void fe({severity:"error",message:"Workflow name is required."});if(0===e.modules.length)return void fe({severity:"error",message:"Select at least one module."});const a=null!==(n=null===(r=e.description)||void 0===r?void 0:r.trim())&&void 0!==n?n:"",i=a.length>0?a:"",s={repeatCount:Math.max(1,Math.trunc(e.repeatSettings.repeatCount)),durationValue:Math.max(0,Math.trunc(e.repeatSettings.durationValue)),durationUnit:e.repeatSettings.durationUnit};if(t){if(!(0,V.Ob)(t,{name:e.name.trim(),description:i,modules:e.modules}))return void fe({severity:"error",message:"Workflow not found."});tt(t,s),fe({severity:"success",message:'Workflow "'.concat(e.name,'" updated.')})}else{const t=(0,V.ss)({name:e.name.trim(),description:i,modules:e.modules});Ee(e=>(0,o.A)((0,o.A)({},e),{},{[t.id]:s})),fe({severity:"success",message:'Workflow "'.concat(e.name,'" created.')})}X((0,V.WF)()),Ct()},repeatSettings:ie?et(ie.id):ee}),(0,$.jsx)(C.A,{open:Boolean(ue),autoHideDuration:4e3,onClose:()=>fe(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:ue?(0,$.jsx)(w.A,{severity:ue.severity,onClose:()=>fe(null),sx:{borderRadius:"8px"},children:ue.message}):null})]})}}}]);
//# sourceMappingURL=447.a011189e.chunk.js.map